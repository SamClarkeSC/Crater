import{u as U,g as L,i as S,j as T,k as _,m as f,n as g,p as A,q as F,D as J,J as O,r as c,o as R,s as X,w as i,t as y,v as h,x as $,y as e,b as s,z as H,B as K}from"./vendor.d8bc4b48.js";import{g as Q,u as W,r as Y,f as Z,o as ee,j as te}from"./main.90d606cc.js";const ae={class:"flex justify-between w-full"},oe=["onSubmit"],ne={class:"px-8 py-8 sm:p-6"},se={class:"z-0 flex justify-end px-4 py-4 border-t border-solid border-gray-light"},le={setup(re){const u=Q(),B=W(),t=Y(),M=Z(),C=ee(),V=te(),l=U(),{t:m}=L();let d=S(!1);const q=T(["Invoice","Estimate","Payment"]);let p=S(["customer","customerCustom"]);const z=_(()=>u.active&&u.componentName==="NoteModal"),E=_(()=>({currentNote:{name:{required:f.withMessage(m("validation.required"),g),minLength:f.withMessage(m("validation.name_min_length",{count:3}),A(3))},notes:{required:f.withMessage(m("validation.required"),g)},type:{required:f.withMessage(m("validation.required"),g)}}})),o=F(E,_(()=>t));J(()=>t.currentNote.type,a=>{I()}),O(()=>{l.name==="estimates.create"?t.currentNote.type="Estimate":l.name==="invoices.create"?t.currentNote.type="Invoice":t.currentNote.type="Payment"});function I(){p.value=["customer","customerCustom"],t.currentNote.type=="Invoice"&&p.value.push("invoice","invoiceCustom"),t.currentNote.type=="Estimate"&&p.value.push("estimate","estimateCustom"),t.currentNote.type=="Payment"&&p.value.push("payment","paymentCustom")}async function x(){if(o.value.currentNote.$touch(),o.value.currentNote.$invalid)return!0;if(d.value=!0,t.isEdit){let a={id:t.currentNote.id,...t.currentNote};await t.updateNote(a).then(n=>{d.value=!1,n.data&&(B.showNotification({type:"success",message:m("settings.customization.notes.note_updated")}),u.refreshData&&u.refreshData(),v())}).catch(n=>{d.value=!1})}else await t.addNote(t.currentNote).then(a=>{d.value=!1,a.data&&(B.showNotification({type:"success",message:m("settings.customization.notes.note_added")}),(l.name==="invoices.create"&&a.data.data.type==="Invoice"||l.name==="invoices.edit"&&a.data.data.type==="Invoice")&&M.selectNote(a.data.data),(l.name==="estimates.create"&&a.data.data.type==="Estimate"||l.name==="estimates.edit"&&a.data.data.type==="Estimate")&&V.selectNote(a.data.data),(l.name==="payments.create"&&a.data.data.type==="Payment"||l.name==="payments.edit"&&a.data.data.type==="Payment")&&C.selectNote(a.data.data)),u.refreshData&&u.refreshData(),v()}).catch(a=>{d.value=!1})}function v(){u.closeModal(),setTimeout(()=>{t.resetCurrentNote(),o.value.$reset()},300)}return(a,n)=>{const b=c("BaseIcon"),D=c("BaseInput"),N=c("BaseInputGroup"),P=c("BaseMultiselect"),k=c("BaseCustomInput"),j=c("BaseInputGrid"),w=c("BaseButton"),G=c("BaseModal");return R(),X(G,{show:e(z),onClose:v,onOpen:I},{header:i(()=>[y("div",ae,[h($(e(u).title)+" ",1),s(b,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:v})])]),default:i(()=>[y("form",{action:"",onSubmit:K(x,["prevent"])},[y("div",ne,[s(j,{layout:"one-column"},{default:i(()=>[s(N,{label:a.$t("settings.customization.notes.name"),variant:"vertical",error:e(o).currentNote.name.$error&&e(o).currentNote.name.$errors[0].$message,required:""},{default:i(()=>[s(D,{modelValue:e(t).currentNote.name,"onUpdate:modelValue":n[0]||(n[0]=r=>e(t).currentNote.name=r),invalid:e(o).currentNote.name.$error,type:"text",onInput:n[1]||(n[1]=r=>e(o).currentNote.name.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),s(N,{label:a.$t("settings.customization.notes.type"),error:e(o).currentNote.type.$error&&e(o).currentNote.type.$errors[0].$message,required:""},{default:i(()=>[s(P,{modelValue:e(t).currentNote.type,"onUpdate:modelValue":n[2]||(n[2]=r=>e(t).currentNote.type=r),options:e(q),"value-prop":"type",class:"mt-2"},null,8,["modelValue","options"])]),_:1},8,["label","error"]),s(N,{label:a.$t("settings.customization.notes.notes"),error:e(o).currentNote.notes.$error&&e(o).currentNote.notes.$errors[0].$message,required:""},{default:i(()=>[s(k,{modelValue:e(t).currentNote.notes,"onUpdate:modelValue":n[3]||(n[3]=r=>e(t).currentNote.notes=r),invalid:e(o).currentNote.notes.$error,fields:e(p),onInput:n[4]||(n[4]=r=>e(o).currentNote.notes.$touch())},null,8,["modelValue","invalid","fields"])]),_:1},8,["label","error"])]),_:1})]),y("div",se,[s(w,{class:"mr-2",variant:"primary-outline",type:"button",onClick:v},{default:i(()=>[h($(a.$t("general.cancel")),1)]),_:1}),s(w,{loading:e(d),disabled:e(d),variant:"primary",type:"submit"},{left:i(r=>[s(b,{name:"SaveIcon",class:H(r.class)},null,8,["class"])]),default:i(()=>[h(" "+$(e(t).isEdit?a.$t("general.update"):a.$t("general.save")),1)]),_:1},8,["loading","disabled"])])],40,oe)]),_:1},8,["show"])}}};export{le as _};
