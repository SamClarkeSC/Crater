import{u as D,i as M,j as J,k as B,D as N,J as K,r as d,o as y,c as E,t as v,b as t,y as e,x as L,w as u,s as _,A as V,F as x,a9 as Q,g as W,C as X,m as f,n as w,aU as U,L as Y,q as Z,z as ee,v as ne,B as ie}from"./vendor.d8bc4b48.js";import{_ as te,a as re,b as ae,c as oe,d as le,e as se}from"./ItemModal.33f61cf4.js";import{B as P,m as ce,c as ue,l as de}from"./main.90d606cc.js";import{_ as ge}from"./ExchangeRateConverter.aa5d19bc.js";import{_ as ve}from"./CreateCustomFields.24725e49.js";import{_ as me}from"./TaxTypeModal.8d4cfdb0.js";import"./DragIcon.a86580cb.js";import"./SelectNotePopup.28912ac9.js";import"./NoteModal.1222fe10.js";const fe={class:"col-span-5 pr-0"},ye={class:"flex mt-7"},be={class:"relative w-20 mt-8"},Ie={class:"ml-2"},$e={class:"p-0 mb-1 leading-snug text-left text-black"},we={class:"p-0 m-0 text-xs leading-tight text-left text-gray-500",style:{"max-width":"480px"}},_e={class:"grid grid-cols-1 col-span-7 gap-4 mt-8 lg:gap-6 lg:mt-0 lg:grid-cols-2"},qe={props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(n){const r=n,F=D(),i=P(),q=ce(),c=M(!1),m=J([{label:"None",value:"NONE"},{label:"Date",value:"DATE"},{label:"Count",value:"COUNT"}]),S=B(()=>i.newRecurringInvoice.selectedFrequency&&i.newRecurringInvoice.selectedFrequency.value==="CUSTOM"),C=B(()=>r.isEdit?q.config.recurring_invoice_status.update_status:q.config.recurring_invoice_status.create_status);N(()=>i.newRecurringInvoice.selectedFrequency,l=>{i.isFetchingInitialSettings||(l&&l.value!=="CUSTOM"?i.newRecurringInvoice.frequency=l.value:i.newRecurringInvoice.frequency=null)}),K(()=>{F.params.id||p()});function I(l){return i.newRecurringInvoice.limit_by===l}const R=Q(()=>{p()},500);async function p(){const l=i.newRecurringInvoice.frequency;if(!l)return;c.value=!0;let a={starts_at:i.newRecurringInvoice.starts_at,frequency:l};try{await i.fetchRecurringInvoiceFrequencyDate(a)}catch(b){console.error(b),c.value=!1}c.value=!1}return(l,a)=>{const b=d("BaseCustomerSelectPopup"),k=d("BaseSwitch"),h=d("BaseDatePicker"),o=d("BaseInputGroup"),g=d("BaseMultiselect"),$=d("BaseInput");return y(),E(x,null,[v("div",fe,[t(b,{modelValue:e(i).newRecurringInvoice.customer,"onUpdate:modelValue":a[0]||(a[0]=s=>e(i).newRecurringInvoice.customer=s),valid:n.v.customer_id,"content-loading":n.isLoading,type:"recurring-invoice"},null,8,["modelValue","valid","content-loading"]),v("div",ye,[v("div",be,[t(k,{modelValue:e(i).newRecurringInvoice.send_automatically,"onUpdate:modelValue":a[1]||(a[1]=s=>e(i).newRecurringInvoice.send_automatically=s),class:"absolute -top-4"},null,8,["modelValue"])]),v("div",Ie,[v("p",$e,L(l.$t("recurring_invoices.send_automatically")),1),v("p",we,L(l.$t("recurring_invoices.send_automatically_desc")),1)])])]),v("div",_e,[t(o,{label:l.$t("recurring_invoices.starts_at"),"content-loading":n.isLoading,required:"",error:n.v.starts_at.$error&&n.v.starts_at.$errors[0].$message},{default:u(()=>[t(h,{modelValue:e(i).newRecurringInvoice.starts_at,"onUpdate:modelValue":a[2]||(a[2]=s=>e(i).newRecurringInvoice.starts_at=s),"content-loading":n.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar",invalid:n.v.starts_at.$error,onChange:a[3]||(a[3]=s=>p())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","error"]),t(o,{label:l.$t("recurring_invoices.next_invoice_date"),"content-loading":n.isLoading,required:""},{default:u(()=>[t(h,{modelValue:e(i).newRecurringInvoice.next_invoice_at,"onUpdate:modelValue":a[4]||(a[4]=s=>e(i).newRecurringInvoice.next_invoice_at=s),"content-loading":n.isLoading,"calendar-button":!0,disabled:!0,loading:c.value,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading","loading"])]),_:1},8,["label","content-loading"]),t(o,{label:l.$t("recurring_invoices.limit_by"),"content-loading":n.isLoading,class:"lg:mt-0",required:"",error:n.v.limit_by.$error&&n.v.limit_by.$errors[0].$message},{default:u(()=>[t(g,{modelValue:e(i).newRecurringInvoice.limit_by,"onUpdate:modelValue":a[5]||(a[5]=s=>e(i).newRecurringInvoice.limit_by=s),"content-loading":n.isLoading,options:e(m),label:"label",invalid:n.v.limit_by.$error,"value-prop":"value"},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","content-loading","error"]),I("DATE")?(y(),_(o,{key:0,label:l.$t("recurring_invoices.limit_date"),"content-loading":n.isLoading,required:I("DATE"),error:n.v.limit_date.$error&&n.v.limit_date.$errors[0].$message},{default:u(()=>[t(h,{modelValue:e(i).newRecurringInvoice.limit_date,"onUpdate:modelValue":a[6]||(a[6]=s=>e(i).newRecurringInvoice.limit_date=s),"content-loading":n.isLoading,invalid:n.v.limit_date.$error,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","required","error"])):V("",!0),I("COUNT")?(y(),_(o,{key:1,label:l.$t("recurring_invoices.count"),"content-loading":n.isLoading,required:I("COUNT"),error:n.v.limit_count.$error&&n.v.limit_count.$errors[0].$message},{default:u(()=>[t($,{modelValue:e(i).newRecurringInvoice.limit_count,"onUpdate:modelValue":a[7]||(a[7]=s=>e(i).newRecurringInvoice.limit_count=s),"content-loading":n.isLoading,invalid:n.v.limit_count.$error,type:"number"},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","required","error"])):V("",!0),t(o,{label:l.$t("recurring_invoices.status"),required:"","content-loading":n.isLoading,error:n.v.status.$error&&n.v.status.$errors[0].$message},{default:u(()=>[t(g,{modelValue:e(i).newRecurringInvoice.status,"onUpdate:modelValue":a[8]||(a[8]=s=>e(i).newRecurringInvoice.status=s),options:e(C),"content-loading":n.isLoading,invalid:n.v.status.$error,placeholder:l.$t("recurring_invoices.select_a_status"),"value-prop":"value",label:"value"},null,8,["modelValue","options","content-loading","invalid","placeholder"])]),_:1},8,["label","content-loading","error"]),t(o,{label:l.$t("recurring_invoices.frequency.select_frequency"),required:"","content-loading":n.isLoading,error:n.v.selectedFrequency.$error&&n.v.selectedFrequency.$errors[0].$message},{default:u(()=>[t(g,{modelValue:e(i).newRecurringInvoice.selectedFrequency,"onUpdate:modelValue":a[9]||(a[9]=s=>e(i).newRecurringInvoice.selectedFrequency=s),"content-loading":n.isLoading,options:e(i).frequencies,label:"label",invalid:n.v.selectedFrequency.$error,object:"",onChange:p},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","content-loading","error"]),e(S)?(y(),_(o,{key:2,label:l.$t("recurring_invoices.frequency.title"),"content-loading":n.isLoading,required:"",error:n.v.frequency.$error&&n.v.frequency.$errors[0].$message},{default:u(()=>[t($,{modelValue:e(i).newRecurringInvoice.frequency,"onUpdate:modelValue":[a[10]||(a[10]=s=>e(i).newRecurringInvoice.frequency=s),e(R)],"content-loading":n.isLoading,disabled:!e(S),invalid:n.v.frequency.$error,loading:c.value},null,8,["modelValue","content-loading","disabled","invalid","loading","onUpdate:modelValue"])]),_:1},8,["label","content-loading","error"])):V("",!0),t(ge,{store:e(i),"store-prop":"newRecurringInvoice",v:n.v,"is-loading":n.isLoading,"is-edit":n.isEdit,"customer-currency":e(i).newRecurringInvoice.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])])],64)}}},Re=["onSubmit"],pe={class:"flex"},Be={class:"grid-cols-12 gap-8 mt-6 mb-8 lg:grid"},he={class:"block mt-10 invoice-foot lg:flex lg:justify-between lg:items-start"},Ve={class:"w-full relative lg:w-1/2"},Ne={setup(n){const r=P(),F=ue(),i=de(),q="newRecurringInvoice",{t:c}=W();let m=M(!1);const S=M(["customer","company","customerCustom","invoice","invoiceCustom"]);let C=D(),I=X(),R=B(()=>r.isFetchingInvoice||r.isFetchingInitialSettings),p=B(()=>l.value?c("recurring_invoices.edit_invoice"):c("recurring_invoices.new_invoice")),l=B(()=>C.name==="recurring-invoices.edit");const a={starts_at:{required:f.withMessage(c("validation.required"),w)},status:{required:f.withMessage(c("validation.required"),w)},frequency:{required:f.withMessage(c("validation.required"),w)},limit_by:{required:f.withMessage(c("validation.required"),w)},limit_date:{required:f.withMessage(c("validation.required"),U(function(){return r.newRecurringInvoice.limit_by==="DATE"}))},limit_count:{required:f.withMessage(c("validation.required"),U(function(){return r.newRecurringInvoice.limit_by==="COUNT"}))},selectedFrequency:{required:f.withMessage(c("validation.required"),w)},customer_id:{required:f.withMessage(c("validation.required"),w)},exchange_rate:{required:U(function(){return f.withMessage(c("validation.required"),w),r.showExchangeRate}),decimal:f.withMessage(c("validation.valid_exchange_rate"),Y)}},b=Z(a,B(()=>r.newRecurringInvoice),{$scope:q});r.resetCurrentRecurringInvoice(),r.fetchRecurringInvoiceInitialSettings(l.value),i.resetCustomFields(),b.value.$reset,N(()=>r.newRecurringInvoice.customer,o=>{o&&o.currency?r.newRecurringInvoice.currency=o.currency:r.newRecurringInvoice.currency=F.selectedCompanyCurrency});async function k(){if(b.value.$touch(),b.value.$invalid)return!1;m.value=!0;let o={...r.newRecurringInvoice,sub_total:r.getSubTotal,total:r.getTotal,tax:r.getTotalTax};C.params.id?r.updateRecurringInvoice(o).then(g=>{g.data.data&&I.push(`/admin/recurring-invoices/${g.data.data.id}/view`),m.value=!1}).catch(g=>{m.value=!1}):h(o)}function h(o){r.addRecurringInvoice(o).then(g=>{g.data.data&&I.push(`/admin/recurring-invoices/${g.data.data.id}/view`),m.value=!1}).catch(g=>{m.value=!1})}return(o,g)=>{const $=d("BaseBreadcrumbItem"),s=d("BaseBreadcrumb"),T=d("BaseButton"),O=d("router-link"),A=d("BaseIcon"),j=d("BasePageHeader"),G=d("BaseScrollPane"),z=d("BasePage");return y(),E(x,null,[t(te),t(re),t(me),t(z,{class:"relative invoice-create-page"},{default:u(()=>[v("form",{onSubmit:ie(k,["prevent"])},[t(j,{title:e(p)},{actions:u(()=>[t(O,{to:`/invoices/pdf/${e(r).newRecurringInvoice.unique_hash}`},{default:u(()=>[o.$route.name==="invoices.edit"?(y(),_(T,{key:0,target:"_blank",class:"mr-3",variant:"primary-outline",type:"button"},{default:u(()=>[v("span",pe,L(o.$t("general.view_pdf")),1)]),_:1})):V("",!0)]),_:1},8,["to"]),t(T,{loading:e(m),disabled:e(m),variant:"primary",type:"submit"},{left:u(H=>[e(m)?V("",!0):(y(),_(A,{key:0,name:"SaveIcon",class:ee(H.class)},null,8,["class"]))]),default:u(()=>[ne(" "+L(o.$t("recurring_invoices.save_invoice")),1)]),_:1},8,["loading","disabled"])]),default:u(()=>[t(s,null,{default:u(()=>[t($,{title:o.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),t($,{title:o.$t("recurring_invoices.title",2),to:"/admin/recurring-invoices"},null,8,["title"]),o.$route.name==="invoices.edit"?(y(),_($,{key:0,title:o.$t("recurring_invoices.edit_invoice"),to:"#",active:""},null,8,["title"])):(y(),_($,{key:1,title:o.$t("recurring_invoices.new_invoice"),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),v("div",Be,[t(qe,{v:e(b),"is-loading":e(R),"is-edit":e(l)},null,8,["v","is-loading","is-edit"])]),t(G,null,{default:u(()=>[t(ae,{currency:e(r).newRecurringInvoice.currency,"is-loading":e(R),"item-validation-scope":q,store:e(r),"store-prop":"newRecurringInvoice"},null,8,["currency","is-loading","store"]),v("div",he,[v("div",Ve,[t(oe,{store:e(r),"store-prop":"newRecurringInvoice",fields:S.value,type:"Invoice"},null,8,["store","fields"]),t(ve,{type:"Invoice","is-edit":e(l),"is-loading":e(R),store:e(r),"store-prop":"newRecurringInvoice","custom-field-scope":q,class:"mb-6"},null,8,["is-edit","is-loading","store"]),t(le,{store:e(r),"store-prop":"newRecurringInvoice"},null,8,["store"])]),t(se,{currency:e(r).newRecurringInvoice.currency,"is-loading":e(R),store:e(r),"store-prop":"newRecurringInvoice","tax-popup-type":"invoice"},null,8,["currency","is-loading","store"])])]),_:1})],40,Re)]),_:1})],64)}}};export{Ne as default};
