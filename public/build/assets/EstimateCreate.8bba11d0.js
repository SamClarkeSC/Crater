import{r as o,o as p,c as k,b as a,y as t,w as n,g as R,i as q,u as z,C as H,k as b,m as c,n as y,a4 as A,aU as O,L as J,q as K,D as Q,t as $,s as B,x as V,A as I,z as W,v as X,B as Y,F as Z}from"./vendor.d8bc4b48.js";import{j as L,c as ee,l as te}from"./main.90d606cc.js";import{_ as ae,a as se,b as ie,c as ne,d as oe,e as re}from"./ItemModal.33f61cf4.js";import{_ as le}from"./CreateCustomFields.24725e49.js";import{_ as me}from"./ExchangeRateConverter.aa5d19bc.js";import{_ as de}from"./TaxTypeModal.8d4cfdb0.js";import"./DragIcon.a86580cb.js";import"./SelectNotePopup.28912ac9.js";import"./NoteModal.1222fe10.js";const ue={class:"md:grid-cols-12 grid-cols-1 md:gap-x-6 mt-6 mb-8 grid gap-y-5"},ce={props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(s){const e=L();return(_,l)=>{const r=o("BaseCustomerSelectPopup"),g=o("BaseDatePicker"),m=o("BaseInputGroup"),E=o("BaseInput"),h=o("BaseInputGrid");return p(),k("div",ue,[a(r,{modelValue:t(e).newEstimate.customer,"onUpdate:modelValue":l[0]||(l[0]=d=>t(e).newEstimate.customer=d),valid:s.v.customer_id,"content-loading":s.isLoading,type:"estimate",class:"col-span-5 pr-0"},null,8,["modelValue","valid","content-loading"]),a(h,{class:"col-span-7"},{default:n(()=>[a(m,{label:_.$t("reports.estimates.estimate_date"),"content-loading":s.isLoading,required:"",error:s.v.estimate_date.$error&&s.v.estimate_date.$errors[0].$message},{default:n(()=>[a(g,{modelValue:t(e).newEstimate.estimate_date,"onUpdate:modelValue":l[1]||(l[1]=d=>t(e).newEstimate.estimate_date=d),"content-loading":s.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),a(m,{label:_.$t("estimates.expiry_date"),"content-loading":s.isLoading,required:"",error:s.v.expiry_date.$error&&s.v.expiry_date.$errors[0].$message},{default:n(()=>[a(g,{modelValue:t(e).newEstimate.expiry_date,"onUpdate:modelValue":l[2]||(l[2]=d=>t(e).newEstimate.expiry_date=d),"content-loading":s.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),a(m,{label:_.$t("estimates.estimate_number"),"content-loading":s.isLoading,required:"",error:s.v.estimate_number.$error&&s.v.estimate_number.$errors[0].$message},{default:n(()=>[a(E,{modelValue:t(e).newEstimate.estimate_number,"onUpdate:modelValue":l[3]||(l[3]=d=>t(e).newEstimate.estimate_number=d),"content-loading":s.isLoading},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),a(me,{store:t(e),"store-prop":"newEstimate",v:s.v,"is-loading":s.isLoading,"is-edit":s.isEdit,"customer-currency":t(e).newEstimate.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])]),_:1})])}}},ge=["onSubmit"],pe={class:"flex"},_e={class:"block mt-10 estimate-foot lg:flex lg:justify-between lg:items-start"},fe={class:"relative w-full lg:w-1/2"},Se={setup(s){const e=L(),_=ee(),l=te(),{t:r}=R(),g="newEstimate";let m=q(!1);const E=q(["customer","company","customerCustom","estimate","estimateCustom"]);let h=z(),d=H(),f=b(()=>e.isFetchingInitialSettings),x=b(()=>v.value?r("estimates.edit_estimate"):r("estimates.new_estimate")),v=b(()=>h.name==="estimates.edit");const P={estimate_date:{required:c.withMessage(r("validation.required"),y)},expiry_date:{required:c.withMessage(r("validation.required"),y)},estimate_number:{required:c.withMessage(r("validation.required"),y)},reference_number:{maxLength:c.withMessage(r("validation.price_maxlength"),A(255))},customer_id:{required:c.withMessage(r("validation.required"),y)},exchange_rate:{required:O(function(){return c.withMessage(r("validation.required"),y),e.showExchangeRate}),decimal:c.withMessage(r("validation.valid_exchange_rate"),J)}},w=K(P,b(()=>e.newEstimate),{$scope:g});Q(()=>e.newEstimate.customer,i=>{i&&i.currency?e.newEstimate.selectedCurrency=i.currency:e.newEstimate.selectedCurrency=_.selectedCompanyCurrency}),e.resetCurrentEstimate(),l.resetCustomFields(),w.value.$reset,e.fetchEstimateInitialSettings(v.value);async function F(){if(w.value.$touch(),w.value.$invalid)return!1;m.value=!0;let i={...e.newEstimate,sub_total:e.getSubTotal,total:e.getTotal,tax:e.getTotalTax};const C=v.value?e.updateEstimate:e.addEstimate;try{let u=await C(i);u.data.data&&d.push(`/admin/estimates/${u.data.data.id}/view`)}catch(u){console.error(u)}m.value=!1}return(i,C)=>{const u=o("BaseBreadcrumbItem"),M=o("BaseBreadcrumb"),S=o("BaseButton"),T=o("router-link"),N=o("BaseIcon"),U=o("BasePageHeader"),D=o("BaseScrollPane"),G=o("BasePage");return p(),k(Z,null,[a(ae),a(se),a(de),a(G,{class:"relative estimate-create-page"},{default:n(()=>[$("form",{onSubmit:Y(F,["prevent"])},[a(U,{title:t(x)},{actions:n(()=>[i.$route.name==="estimates.edit"?(p(),B(T,{key:0,to:`/estimates/pdf/${t(e).newEstimate.unique_hash}`,target:"_blank"},{default:n(()=>[a(S,{class:"mr-3",variant:"primary-outline",type:"button"},{default:n(()=>[$("span",pe,V(i.$t("general.view_pdf")),1)]),_:1})]),_:1},8,["to"])):I("",!0),a(S,{loading:t(m),disabled:t(m),"content-loading":t(f),variant:"primary",type:"submit"},{left:n(j=>[t(m)?I("",!0):(p(),B(N,{key:0,class:W(j.class),name:"SaveIcon"},null,8,["class"]))]),default:n(()=>[X(" "+V(i.$t("estimates.save_estimate")),1)]),_:1},8,["loading","disabled","content-loading"])]),default:n(()=>[a(M,null,{default:n(()=>[a(u,{title:i.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),a(u,{title:i.$tc("estimates.estimate",2),to:"/admin/estimates"},null,8,["title"]),i.$route.name==="estimates.edit"?(p(),B(u,{key:0,title:i.$t("estimates.edit_estimate"),to:"#",active:""},null,8,["title"])):(p(),B(u,{key:1,title:i.$t("estimates.new_estimate"),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),a(ce,{v:t(w),"is-loading":t(f),"is-edit":t(v)},null,8,["v","is-loading","is-edit"]),a(D,null,{default:n(()=>[a(ie,{currency:t(e).newEstimate.selectedCurrency,"is-loading":t(f),"item-validation-scope":g,store:t(e),"store-prop":"newEstimate"},null,8,["currency","is-loading","store"]),$("div",_e,[$("div",fe,[a(ne,{store:t(e),"store-prop":"newEstimate",fields:E.value,type:"Estimate"},null,8,["store","fields"]),a(le,{type:"Estimate","is-edit":t(v),"is-loading":t(f),store:t(e),"store-prop":"newEstimate","custom-field-scope":g,class:"mb-6"},null,8,["is-edit","is-loading","store"]),a(oe,{store:t(e),"component-name":"EstimateTemplate","store-prop":"newEstimate"},null,8,["store"])]),a(re,{currency:t(e).newEstimate.selectedCurrency,"is-loading":t(f),store:t(e),"store-prop":"newEstimate","tax-popup-type":"estimate"},null,8,["currency","is-loading","store"])])]),_:1})],40,ge)]),_:1})],64)}}};export{Se as default};
