import{x as j,g as L,w as U,i as J}from"./main.90d606cc.js";import{i as v,j as F,g as O,k as y,m as q,n as x,q as K,r as l,o as T,s as G,w as s,t as D,v as w,x as $,y as t,b as a,z as A,A as Q,B as W,c as Y,F as Z}from"./vendor.d8bc4b48.js";const ee={class:"flex justify-between w-full"},te=["onSubmit"],ae={class:"p-6"},se={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},oe={setup(E){v(null),v(!1);let _=v(!1),g=v(!1);const I=F(["full","only-db","only-files"]),r=j(),o=L(),d=U(),{t:k}=O(),p=y(()=>o.active&&o.componentName==="BackupModal"),S=y(()=>d.disks.map(n=>({...n,name:n.name+" \u2014 ["+n.driver+"]"}))),M=y(()=>({currentBackupData:{option:{required:q.withMessage(k("validation.required"),x)},selected_disk:{required:q.withMessage(k("validation.required"),x)}}})),m=K(M,y(()=>r));async function V(){if(m.value.currentBackupData.$touch(),m.value.currentBackupData.$invalid)return!0;let n={option:r.currentBackupData.option,file_disk_id:r.currentBackupData.selected_disk.id};try{_.value=!0,(await r.createBackup(n)).data&&(_.value=!1,o.refreshData&&o.refreshData(),o.closeModal())}catch{_.value=!1}}async function z(){g.value=!0;let n=await d.fetchDisks({limit:"all"});r.currentBackupData.selected_disk=n.data.data[0],g.value=!1}function C(){o.closeModal(),setTimeout(()=>{m.value.$reset(),r.$reset()})}return(n,f)=>{const e=l("BaseIcon"),c=l("BaseMultiselect"),u=l("BaseInputGroup"),i=l("BaseInputGrid"),B=l("BaseButton"),N=l("BaseModal");return T(),G(N,{show:t(p),onClose:C,onOpen:z},{header:s(()=>[D("div",ee,[w($(t(o).title)+" ",1),a(e,{name:"XIcon",class:"w-6 h-6 text-gray-500 cursor-pointer",onClick:C})])]),default:s(()=>[D("form",{onSubmit:W(V,["prevent"])},[D("div",ae,[a(i,{layout:"one-column"},{default:s(()=>[a(u,{label:n.$t("settings.backup.select_backup_type"),error:t(m).currentBackupData.option.$error&&t(m).currentBackupData.option.$errors[0].$message,horizontal:"",required:"",class:"py-2"},{default:s(()=>[a(c,{modelValue:t(r).currentBackupData.option,"onUpdate:modelValue":f[0]||(f[0]=b=>t(r).currentBackupData.option=b),options:t(I),"can-deselect":!1,placeholder:n.$t("settings.backup.select_backup_type"),searchable:""},null,8,["modelValue","options","placeholder"])]),_:1},8,["label","error"]),a(u,{label:n.$t("settings.disk.select_disk"),error:t(m).currentBackupData.selected_disk.$error&&t(m).currentBackupData.selected_disk.$errors[0].$message,horizontal:"",required:"",class:"py-2"},{default:s(()=>[a(c,{modelValue:t(r).currentBackupData.selected_disk,"onUpdate:modelValue":f[1]||(f[1]=b=>t(r).currentBackupData.selected_disk=b),"content-loading":t(g),options:t(S),searchable:!0,"allow-empty":!1,label:"name","value-prop":"id",placeholder:n.$t("settings.disk.select_disk"),"track-by":"id",object:""},null,8,["modelValue","content-loading","options","placeholder"])]),_:1},8,["label","error"])]),_:1})]),D("div",se,[a(B,{class:"mr-3",variant:"primary-outline",type:"button",onClick:C},{default:s(()=>[w($(n.$t("general.cancel")),1)]),_:1}),a(B,{loading:t(_),disabled:t(_),variant:"primary",type:"submit"},{left:s(b=>[t(_)?Q("",!0):(T(),G(e,{key:0,name:"SaveIcon",class:A(b.class)},null,8,["class"]))]),default:s(()=>[w(" "+$(n.$t("general.create")),1)]),_:1},8,["loading","disabled"])])],40,te)]),_:1},8,["show"])}}},ne={class:"grid my-14 md:grid-cols-3"},le={class:"inline-block"},ie={setup(E){const _=J(),g=j(),I=L(),r=U(),{t:o}=O(),d=F({selected_disk:{driver:"local"}}),k=v("");let p=v(!0);const S=y(()=>[{key:"path",label:o("settings.backup.path"),thClass:"extra",tdClass:"font-medium text-gray-900"},{key:"created_at",label:o("settings.backup.created_at"),tdClass:"font-medium text-gray-900"},{key:"size",label:o("settings.backup.size"),tdClass:"font-medium text-gray-900"},{key:"actions",label:"",tdClass:"text-right text-sm font-medium",sortable:!1}]),M=y(()=>r.disks.map(e=>({...e,name:e.name+" \u2014 ["+e.driver+"]"})));z();function m(e){_.openDialog({title:o("general.are_you_sure"),message:o("settings.backup.backup_confirm_delete"),yesLabel:o("general.ok"),noLabel:o("general.cancel"),variant:"danger",hideNoButton:!1,size:"lg"}).then(async c=>{if(c){let u={disk:d.selected_disk.driver,file_disk_id:d.selected_disk.id,path:e.path},i=await g.removeBackup(u);if(i.data.success||i.data.backup)return k.value&&k.value.refresh(),!0}})}function V(){setTimeout(()=>{k.value.refresh()},100)}async function z(){p.value=!0;let e=await r.fetchDisks({limit:"all"});e.data.error,d.selected_disk=e.data.data.find(c=>c.set_as_default==0),p.value=!1}async function C({page:e,filter:c,sort:u}){let i={disk:d.selected_disk.driver,filed_disk_id:d.selected_disk.id};p.value=!0;let B=await g.fetchBackups(i);return p.value=!1,{data:B.data.backups,pagination:{totalPages:1,currentPage:1}}}async function n(){I.openModal({title:o("settings.backup.create_backup"),componentName:"BackupModal",refreshData:k.value&&k.value.refresh,size:"sm"})}async function f(e){p.value=!0,window.axios({method:"GET",url:"/api/v1/download-backup",responseType:"blob",params:{disk:d.selected_disk.driver,file_disk_id:d.selected_disk.id,path:e.path}}).then(c=>{const u=window.URL.createObjectURL(new Blob([c.data])),i=document.createElement("a");i.href=u,i.setAttribute("download",e.path.split("/")[1]),document.body.appendChild(i),i.click(),p.value=!1}).catch(c=>{p.value=!1})}return(e,c)=>{const u=l("BaseIcon"),i=l("BaseButton"),B=l("BaseMultiselect"),N=l("BaseInputGroup"),b=l("BaseDropdownItem"),P=l("BaseDropdown"),R=l("BaseTable"),H=l("BaseSettingCard");return T(),Y(Z,null,[a(oe),a(H,{title:e.$tc("settings.backup.title",1),description:e.$t("settings.backup.description")},{action:s(()=>[a(i,{variant:"primary-outline",onClick:n},{left:s(h=>[a(u,{class:A(h.class),name:"PlusIcon"},null,8,["class"])]),default:s(()=>[w(" "+$(e.$t("settings.backup.new_backup")),1)]),_:1})]),default:s(()=>[D("div",ne,[a(N,{label:e.$t("settings.disk.select_disk"),"content-loading":t(p)},{default:s(()=>[a(B,{modelValue:t(d).selected_disk,"onUpdate:modelValue":c[0]||(c[0]=h=>t(d).selected_disk=h),"content-loading":t(p),options:t(M),"track-by":"id",placeholder:e.$t("settings.disk.select_disk"),label:"name",searchable:!0,object:"",class:"w-full","value-prop":"id",onSelect:V},null,8,["modelValue","content-loading","options","placeholder"])]),_:1},8,["label","content-loading"])]),a(R,{ref_key:"table",ref:k,class:"mt-10","show-filter":!1,data:C,columns:t(S)},{"cell-actions":s(({row:h})=>[a(P,null,{activator:s(()=>[D("div",le,[a(u,{name:"DotsHorizontalIcon",class:"text-gray-500"})])]),default:s(()=>[a(b,{onClick:X=>f(h.data)},{default:s(()=>[a(u,{name:"CloudDownloadIcon",class:"mr-3 text-gray-600"}),w(" "+$(e.$t("general.download")),1)]),_:2},1032,["onClick"]),a(b,{onClick:X=>m(h.data)},{default:s(()=>[a(u,{name:"TrashIcon",class:"mr-3 text-gray-600"}),w(" "+$(e.$t("general.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["columns"])]),_:1},8,["title","description"])],64)}}};export{ie as default};
