import{g as Z,u as ee,C as te,i as y,k as u,m as V,n as ne,p as ae,a4 as oe,q as se,r as s,o as S,s as h,w as l,b as a,y as e,t as C,a0 as U,v as k,x as P,A as q,z as le,B as re}from"./vendor.d8bc4b48.js";import{p as ie,q as me,g as ue,c as ce,d as de,e as pe}from"./main.90d606cc.js";import{_ as _e}from"./ItemUnitModal.8e154097.js";const ge=["onSubmit"],be={setup(Ie){const n=ie(),x=me(),v=ue(),N=ce(),{t:c}=Z(),B=ee(),z=te(),A=de(),p=y(!1),b=y(N.selectedCompanySettings.tax_per_item);let r=y(!1);n.$reset(),R();const g=u({get:()=>n.currentItem.price/100,set:t=>{n.currentItem.price=Math.round(t*100)}}),$=u({get:()=>n?.currentItem?.taxes?.map(t=>{if(t)return{...t,tax_type_id:t.id,tax_name:t.name+" ("+t.percent+"%)"}}),set:t=>{n.currentItem.taxes=t}}),I=u(()=>B.name==="items.edit"),T=u(()=>I.value?c("items.edit_item"):c("items.new_item")),E=u(()=>x.taxTypes.map(t=>({...t,tax_type_id:t.id,tax_name:t.name+" ("+t.percent+"%)"}))),G=u(()=>b.value==="YES"),L=u(()=>({currentItem:{name:{required:V.withMessage(c("validation.required"),ne),minLength:V.withMessage(c("validation.name_min_length",{count:3}),ae(3))},description:{maxLength:V.withMessage(c("validation.description_maxlength"),oe(65e3))}}})),m=se(L,n);async function D(){v.openModal({title:c("settings.customization.items.add_item_unit"),componentName:"ItemUnitModal",size:"sm"})}async function R(){if(r.value=!0,await n.fetchItemUnits({limit:"all"}),A.hasAbilities(pe.VIEW_TAX_TYPE)&&await x.fetchTaxTypes({limit:"all"}),I.value){let t=B.params.id;await n.fetchItem(t),n.currentItem.tax_per_item===1?b.value="YES":b.value="NO"}r.value=!1}async function Y(){if(m.value.currentItem.$touch(),m.value.currentItem.$invalid)return!1;p.value=!0;try{let o={id:B.params.id,...n.currentItem};n.currentItem&&n.currentItem.taxes&&(o.taxes=n.currentItem.taxes.map(d=>({tax_type_id:d.tax_type_id,amount:g.value*d.percent,percent:d.percent,name:d.name,collective_tax:0}))),await(I.value?n.updateItem:n.addItem)(o),p.value=!1,z.push("/admin/items"),t()}catch{p.value=!1;return}function t(){v.closeModal(),setTimeout(()=>{n.resetCurrentItem(),v.$reset(),m.value.$reset()},300)}}return(t,o)=>{const f=s("BaseBreadcrumbItem"),d=s("BaseBreadcrumb"),H=s("BasePageHeader"),j=s("BaseInput"),_=s("BaseInputGroup"),F=s("BaseMoney"),w=s("BaseIcon"),O=s("BaseSelectAction"),M=s("BaseMultiselect"),W=s("BaseTextarea"),X=s("BaseButton"),J=s("BaseInputGrid"),K=s("BaseCard"),Q=s("BasePage");return S(),h(Q,null,{default:l(()=>[a(H,{title:e(T)},{default:l(()=>[a(d,null,{default:l(()=>[a(f,{title:t.$t("general.home"),to:"dashboard"},null,8,["title"]),a(f,{title:t.$tc("items.item",2),to:"/admin/items"},null,8,["title"]),a(f,{title:e(T),to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),a(_e),C("form",{class:"grid lg:grid-cols-2 mt-6",action:"submit",onSubmit:re(Y,["prevent"])},[a(K,{class:"w-full"},{default:l(()=>[a(J,{layout:"one-column"},{default:l(()=>[a(_,{label:t.$t("items.name"),"content-loading":e(r),required:"",error:e(m).currentItem.name.$error&&e(m).currentItem.name.$errors[0].$message},{default:l(()=>[a(j,{modelValue:e(n).currentItem.name,"onUpdate:modelValue":o[0]||(o[0]=i=>e(n).currentItem.name=i),"content-loading":e(r),invalid:e(m).currentItem.name.$error,onInput:o[1]||(o[1]=i=>e(m).currentItem.name.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","error"]),a(_,{label:t.$t("items.price"),"content-loading":e(r)},{default:l(()=>[a(F,{modelValue:e(g),"onUpdate:modelValue":o[2]||(o[2]=i=>U(g)?g.value=i:null),"content-loading":e(r)},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),a(_,{"content-loading":e(r),label:t.$t("items.unit")},{default:l(()=>[a(M,{modelValue:e(n).currentItem.unit_id,"onUpdate:modelValue":o[3]||(o[3]=i=>e(n).currentItem.unit_id=i),"content-loading":e(r),label:"name",options:e(n).itemUnits,"value-prop":"id","can-deselect":!1,"can-clear":!1,placeholder:t.$t("items.select_a_unit"),searchable:"","track-by":"name"},{action:l(()=>[a(O,{onClick:D},{default:l(()=>[a(w,{name:"PlusIcon",class:"h-4 mr-2 -ml-2 text-center text-primary-400"}),k(" "+P(t.$t("settings.customization.items.add_item_unit")),1)]),_:1})]),_:1},8,["modelValue","content-loading","options","placeholder"])]),_:1},8,["content-loading","label"]),e(G)?(S(),h(_,{key:0,label:t.$t("items.taxes"),"content-loading":e(r)},{default:l(()=>[a(M,{modelValue:e($),"onUpdate:modelValue":o[4]||(o[4]=i=>U($)?$.value=i:null),"content-loading":e(r),options:e(E),mode:"tags",label:"tax_name",class:"w-full","value-prop":"id","can-deselect":!1,"can-clear":!1,searchable:"","track-by":"tax_name",object:""},null,8,["modelValue","content-loading","options"])]),_:1},8,["label","content-loading"])):q("",!0),a(_,{label:t.$t("items.description"),"content-loading":e(r),error:e(m).currentItem.description.$error&&e(m).currentItem.description.$errors[0].$message},{default:l(()=>[a(W,{modelValue:e(n).currentItem.description,"onUpdate:modelValue":o[5]||(o[5]=i=>e(n).currentItem.description=i),"content-loading":e(r),name:"description",row:2,rows:"2",onInput:o[6]||(o[6]=i=>e(m).currentItem.description.$touch())},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),C("div",null,[a(X,{"content-loading":e(r),type:"submit",loading:p.value},{left:l(i=>[p.value?q("",!0):(S(),h(w,{key:0,name:"SaveIcon",class:le(i.class)},null,8,["class"]))]),default:l(()=>[k(" "+P(e(I)?t.$t("items.update_item"):t.$t("items.save_item")),1)]),_:1},8,["content-loading","loading"])])]),_:1})]),_:1})],40,ge)]),_:1})}}};export{be as default};
