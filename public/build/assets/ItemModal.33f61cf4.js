import{q as ee,g as H,d as ce,c as Q,p as de,e as ue,T as me,j as be,u as _e}from"./main.90d606cc.js";import{D as ve,d as $e}from"./DragIcon.a86580cb.js";import{i as R,j as we,am as te,g as J,k as $,D as re,r as m,o as a,c as p,t as n,x as f,b as s,a5 as Be,y as r,w as i,v as j,s as I,A as L,u as Ie,l as le,m as N,n as Z,b4 as ie,a4 as K,aZ as Se,q as pe,a0 as Y,F as G,H as X,G as ye,ac as Pe,a6 as ke,z as A,T as Te,a7 as Ce,a8 as Me,p as De,J as je,B as Ve}from"./vendor.d8bc4b48.js";import{_ as qe}from"./SelectNotePopup.28912ac9.js";const Le={class:"flex items-center justify-between mb-3"},Ee={class:"flex items-center text-base",style:{flex:"4"}},Oe={class:"pr-2 mb-0",align:"right"},Ne={class:"absolute left-3.5"},Ue={class:"ml-2 text-sm leading-none text-primary-400 cursor-pointer"},Fe=n("br",null,null,-1),Ae={class:"text-sm text-right",style:{flex:"3"}},ze={class:"flex items-center justify-center w-6 h-10 mx-2 cursor-pointer"},We={props:{ability:{type:String,default:""},store:{type:Object,default:null},storeProp:{type:String,default:""},itemIndex:{type:Number,required:!0},index:{type:Number,required:!0},taxData:{type:Object,required:!0},taxes:{type:Array,default:[]},total:{type:Number,default:0},totalTax:{type:Number,default:0},currency:{type:[Object,String],required:!0},updateItems:{type:Function,default:()=>{}}},emits:["remove","update"],setup(e,{emit:o}){const t=e,y=ee(),b=H(),_=ce(),w=R(null),d=we({...t.taxData});te("utils");const{t:P}=J(),k=$(()=>y.taxTypes.map(g=>({...g})).map(g=>(t.taxes.find(x=>x.tax_type_id===g.id)?g.disabled=!0:g.disabled=!1,g))),M=$(()=>d.compound_tax&&t.total?(t.total+t.totalTax)*d.percent/100:t.total&&d.percent?t.total*d.percent/100:0);re(()=>t.total,()=>{T()}),re(()=>t.totalTax,()=>{T()}),t.taxData.tax_type_id>0&&(w.value=y.taxTypes.find(c=>c.id===t.taxData.tax_type_id)),T();function V(c){d.percent=c.percent,d.tax_type_id=c.id,d.compound_tax=c.compound_tax,d.name=c.name,T()}function T(){d.tax_type_id!==0&&o("update",{index:t.index,item:{...d,amount:M.value}})}function l(){let c={itemIndex:t.itemIndex,taxIndex:t.index};b.openModal({title:P("settings.tax_types.add_tax"),componentName:"TaxTypeModal",data:c,size:"sm"})}function h(c){t.store.$patch(g=>{g[t.storeProp].items[t.itemIndex].taxes.splice(c,1)})}return(c,g)=>{const C=m("BaseIcon"),x=m("BaseMultiselect"),S=m("BaseFormatMoney");return a(),p("div",Le,[n("div",Ee,[n("label",Oe,f(c.$t("invoices.item.tax")),1),s(x,{modelValue:w.value,"onUpdate:modelValue":[g[0]||(g[0]=B=>w.value=B),g[1]||(g[1]=B=>V(B))],"value-prop":"id",options:r(k),placeholder:c.$t("general.select_a_tax"),"open-direction":"top","track-by":"name",searchable:"",object:"",label:"name"},Be({singlelabel:i(({value:B})=>[n("div",Ne,f(B.name)+" - "+f(B.percent)+" % ",1)]),option:i(({option:B})=>[j(f(B.name)+" - "+f(B.percent)+" % ",1)]),_:2},[r(_).hasAbilities(e.ability)?{name:"action",fn:i(()=>[n("button",{type:"button",class:"flex items-center justify-center w-full px-2 cursor-pointer py-2 bg-gray-200 border-none outline-none",onClick:l},[s(C,{name:"CheckCircleIcon",class:"h-5 text-primary-400"}),n("label",Ue,f(c.$t("invoices.add_new_tax")),1)])])}:void 0]),1032,["modelValue","options","placeholder"]),Fe]),n("div",Ae,[s(S,{amount:r(M),currency:e.currency},null,8,["amount","currency"])]),n("div",ze,[e.taxes.length&&e.index!==e.taxes.length-1?(a(),I(C,{key:0,name:"TrashIcon",class:"h-5 text-gray-700 cursor-pointer",onClick:g[2]||(g[2]=B=>h(e.index))})):L("",!0)])])}}},Ye={class:"box-border bg-white border border-gray-200 border-solid rounded-b"},Re={colspan:"5",class:"p-0 text-left align-top"},Ge={class:"w-full"},Xe=n("col",{style:{width:"40%","min-width":"280px"}},null,-1),He=n("col",{style:{width:"10%","min-width":"120px"}},null,-1),Je=n("col",{style:{width:"15%","min-width":"120px"}},null,-1),Ze={key:0,style:{width:"15%","min-width":"160px"}},Ke=n("col",{style:{width:"15%","min-width":"120px"}},null,-1),Qe={class:"px-5 py-4 text-left align-top"},et={class:"flex justify-start"},tt={class:"flex items-center justify-center w-5 h-5 mt-2 text-gray-300 cursor-move handle mr-2"},ot={class:"px-5 py-4 text-right align-top"},nt={class:"px-5 py-4 text-left align-top"},st={class:"flex flex-col"},at={class:"flex-auto flex-fill bd-highlight"},rt={class:"relative w-full"},lt={key:0,class:"px-5 py-4 text-left align-top"},it={class:"flex flex-col"},ct={class:"flex",style:{width:"120px"},role:"group"},dt={class:"flex items-center"},ut={class:"px-5 py-4 text-right align-top"},mt={class:"flex items-center justify-end text-sm"},pt={class:"flex items-center justify-center w-6 h-10 mx-2"},yt={key:0},xt=n("td",{class:"px-5 py-4 text-left align-top"},null,-1),ft={colspan:"4",class:"px-5 py-4 text-left align-top"},ht={props:{store:{type:Object,default:null},storeProp:{type:String,default:""},itemData:{type:Object,default:null},index:{type:Number,default:null},type:{type:String,default:""},loading:{type:Boolean,default:!1},currency:{type:[Object,String],required:!0},invoiceItems:{type:Array,required:!0},itemValidationScope:{type:String,default:""}},emits:["update","remove","itemValidate"],setup(e,{emit:o}){const t=e,y=Q(),b=de();Ie();const{t:_}=J(),w=$({get:()=>t.itemData.quantity,set:u=>{q("quantity",parseFloat(u))}}),d=$({get:()=>{const u=t.itemData.price;return parseFloat(u)>0?u/100:u},set:u=>{if(parseFloat(u)>0){let v=Math.round(u*100);q("price",v)}else q("price",u)}}),P=$(()=>t.itemData.price*t.itemData.quantity),k=$({get:()=>t.itemData.discount,set:u=>{t.itemData.discount_type==="percentage"?q("discount_val",P.value*u/100):q("discount_val",Math.round(u*100)),q("discount",u)}}),M=$(()=>P.value-t.itemData.discount_val),V=$(()=>t.currency?t.currency:y.selectedCompanyCurrency),T=$(()=>t.store[t.storeProp].items.length!=1),l=$(()=>Math.round(le.exports.sumBy(t.itemData.taxes,function(u){return u.compound_tax?0:u.amount}))),h=$(()=>Math.round(le.exports.sumBy(t.itemData.taxes,function(u){return u.compound_tax?u.amount:0}))),c=$(()=>l.value+h.value),g={name:{required:N.withMessage(_("validation.required"),Z)},quantity:{required:N.withMessage(_("validation.required"),Z),minValue:N.withMessage(_("validation.qty_must_greater_than_zero"),ie(0)),maxLength:N.withMessage(_("validation.amount_maxlength"),K(20))},price:{required:N.withMessage(_("validation.required"),Z),minValue:N.withMessage(_("validation.number_length_minvalue"),ie(1)),maxLength:N.withMessage(_("validation.price_maxlength"),K(20))},discount_val:{between:N.withMessage(_("validation.discount_maxlength"),Se(0,$(()=>P.value)))},description:{maxLength:N.withMessage(_("validation.notes_maxlength"),K(65e3))}},C=pe(g,$(()=>t.store[t.storeProp].items[t.index]),{$scope:t.itemValidationScope});function x(u){t.store.$patch(O=>{O[t.storeProp].items[t.index].taxes[u.index]=u.item}),t.itemData.taxes[t.itemData.taxes.length-1]?.tax_type_id!==0&&t.store.$patch(O=>{O[t.storeProp].items[t.index].taxes.push({...me,id:ye.raw()})}),D()}function S(u){q("name",u)}function B(u){t.store.$patch(v=>{if(v[t.storeProp].items[t.index].name=u.name,v[t.storeProp].items[t.index].price=u.price,v[t.storeProp].items[t.index].item_id=u.id,v[t.storeProp].items[t.index].description=u.description,u.unit&&(v[t.storeProp].items[t.index].unit_name=u.unit.name),t.store[t.storeProp].tax_per_item==="YES"&&u.taxes){let O=0;u.taxes.forEach(W=>{x({index:O,item:{...W}}),O++})}v[t.storeProp].exchange_rate&&(v[t.storeProp].items[t.index].price/=v[t.storeProp].exchange_rate)}),b.fetchItems(),D()}function z(){t.itemData.discount_type!=="fixed"&&(q("discount_val",Math.round(t.itemData.discount*100)),q("discount_type","fixed"))}function F(){t.itemData.discount_type!=="percentage"&&(q("discount_val",P.value*t.itemData.discount/100),q("discount_type","percentage"))}function D(){let u=t.store[t.storeProp]?.items[t.index]?.taxes;u||(u=[]);let v={...t.store[t.storeProp].items[t.index],index:t.index,total:M.value,sub_total:P.value,totalSimpleTax:l.value,totalCompoundTax:h.value,totalTax:c.value,tax:c.value,taxes:[...u]};t.store.updateItem(v)}function q(u,v){t.store.$patch(O=>{O[t.storeProp].items[t.index][u]=v}),D()}return(u,v)=>{const O=m("BaseItemSelect"),W=m("BaseInput"),E=m("BaseMoney"),oe=m("BaseIcon"),xe=m("BaseButton"),ne=m("BaseDropdownItem"),fe=m("BaseDropdown"),se=m("BaseContentPlaceholdersText"),ae=m("BaseContentPlaceholders"),he=m("BaseFormatMoney");return a(),p("tr",Ye,[n("td",Re,[n("table",Ge,[n("colgroup",null,[Xe,He,Je,e.store[e.storeProp].discount_per_item==="YES"?(a(),p("col",Ze)):L("",!0),Ke]),n("tbody",null,[n("tr",null,[n("td",Qe,[n("div",et,[n("div",tt,[s(ve)]),s(O,{type:"Invoice",item:e.itemData,invalid:r(C).name.$error,"invalid-description":r(C).description.$error,taxes:e.itemData.taxes,index:e.index,"store-prop":e.storeProp,store:e.store,onSearch:S,onSelect:B},null,8,["item","invalid","invalid-description","taxes","index","store-prop","store"])])]),n("td",ot,[s(W,{modelValue:r(w),"onUpdate:modelValue":v[0]||(v[0]=U=>Y(w)?w.value=U:null),invalid:r(C).quantity.$error,"content-loading":e.loading,type:"number",small:"",min:"0",step:"any",onChange:v[1]||(v[1]=U=>D()),onInput:v[2]||(v[2]=U=>r(C).quantity.$touch())},null,8,["modelValue","invalid","content-loading"])]),n("td",nt,[n("div",st,[n("div",at,[n("div",rt,[(a(),I(E,{key:r(V),modelValue:r(d),"onUpdate:modelValue":v[3]||(v[3]=U=>Y(d)?d.value=U:null),invalid:r(C).price.$error,"content-loading":e.loading,currency:r(V)},null,8,["modelValue","invalid","content-loading","currency"]))])])])]),e.store[e.storeProp].discount_per_item==="YES"?(a(),p("td",lt,[n("div",it,[n("div",ct,[s(W,{modelValue:r(k),"onUpdate:modelValue":v[4]||(v[4]=U=>Y(k)?k.value=U:null),invalid:r(C).discount_val.$error,"content-loading":e.loading,class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-br-sm h-[38px]"},null,8,["modelValue","invalid","content-loading"]),s(fe,{position:"bottom-end"},{activator:i(()=>[s(xe,{"content-loading":e.loading,class:"rounded-tr-md rounded-br-md !p-2 rounded-none",type:"button",variant:"white"},{default:i(()=>[n("span",dt,[j(f(e.itemData.discount_type=="fixed"?e.currency.symbol:"%")+" ",1),s(oe,{name:"ChevronDownIcon",class:"w-4 h-4 text-gray-500 ml-1"})])]),_:1},8,["content-loading"])]),default:i(()=>[s(ne,{onClick:z},{default:i(()=>[j(f(u.$t("general.fixed")),1)]),_:1}),s(ne,{onClick:F},{default:i(()=>[j(f(u.$t("general.percentage")),1)]),_:1})]),_:1})])])])):L("",!0),n("td",ut,[n("div",mt,[n("span",null,[e.loading?(a(),I(ae,{key:0},{default:i(()=>[s(se,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),I(he,{key:1,amount:r(M),currency:r(V)},null,8,["amount","currency"]))]),n("div",pt,[r(T)?(a(),I(oe,{key:0,class:"h-5 text-gray-700 cursor-pointer",name:"TrashIcon",onClick:v[5]||(v[5]=U=>e.store.removeItem(e.index))})):L("",!0)])])])]),e.store[e.storeProp].tax_per_item==="YES"?(a(),p("tr",yt,[xt,n("td",ft,[e.loading?(a(),I(ae,{key:0},{default:i(()=>[s(se,{lines:1,class:"w-24 h-8 rounded-md border"})]),_:1})):(a(!0),p(G,{key:1},X(e.itemData.taxes,(U,ge)=>(a(),I(We,{key:U.id,index:ge,"item-index":e.index,"tax-data":U,taxes:e.itemData.taxes,"discounted-total":r(M),"total-tax":r(l),total:r(P),currency:e.currency,"update-items":D,ability:r(ue).CREATE_INVOICE,store:e.store,"store-prop":e.storeProp,onUpdate:x},null,8,["index","item-index","tax-data","taxes","discounted-total","total-tax","total","currency","ability","store","store-prop"]))),128))])])):L("",!0)])])])])}}},gt={class:"text-center item-table min-w-full"},bt=n("col",{style:{width:"40%","min-width":"280px"}},null,-1),_t=n("col",{style:{width:"10%","min-width":"120px"}},null,-1),vt=n("col",{style:{width:"15%","min-width":"120px"}},null,-1),$t={key:0,style:{width:"15%","min-width":"160px"}},wt=n("col",{style:{width:"15%","min-width":"120px"}},null,-1),Bt={class:"bg-white border border-gray-200 border-solid"},It={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},St={key:1,class:"pl-7"},Pt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},kt={key:1},Tt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},Ct={key:1},Mt={key:0,class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},Dt={key:1},jt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},Vt={key:1,class:"pr-10 column-heading"},qo={props:{store:{type:Object,default:null},storeProp:{type:String,default:""},currency:{type:[Object,String,null],required:!0},isLoading:{type:Boolean,default:!1},itemValidationScope:{type:String,default:""}},setup(e){const o=e,t=Q(),y=$(()=>o.currency?o.currency:t.selectedCompanyCurrency);return(b,_)=>{const w=m("BaseContentPlaceholdersText"),d=m("BaseContentPlaceholders"),P=m("BaseIcon");return a(),p(G,null,[n("table",gt,[n("colgroup",null,[bt,_t,vt,e.store[e.storeProp].discount_per_item==="YES"?(a(),p("col",$t)):L("",!0),wt]),n("thead",Bt,[n("tr",null,[n("th",It,[e.isLoading?(a(),I(d,{key:0},{default:i(()=>[s(w,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),p("span",St,f(b.$tc("items.item",2)),1))]),n("th",Pt,[e.isLoading?(a(),I(d,{key:0},{default:i(()=>[s(w,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),p("span",kt,f(b.$t("invoices.item.quantity")),1))]),n("th",Tt,[e.isLoading?(a(),I(d,{key:0},{default:i(()=>[s(w,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),p("span",Ct,f(b.$t("invoices.item.price")),1))]),e.store[e.storeProp].discount_per_item==="YES"?(a(),p("th",Mt,[e.isLoading?(a(),I(d,{key:0},{default:i(()=>[s(w,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),p("span",Dt,f(b.$t("invoices.item.discount")),1))])):L("",!0),n("th",jt,[e.isLoading?(a(),I(d,{key:0},{default:i(()=>[s(w,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),p("span",Vt,f(b.$t("invoices.item.amount")),1))])])]),s(r($e),{modelValue:e.store[e.storeProp].items,"onUpdate:modelValue":_[0]||(_[0]=k=>e.store[e.storeProp].items=k),"item-key":"id",tag:"tbody",handle:".handle"},{item:i(({element:k,index:M})=>[(a(),I(ht,{key:k.id,index:M,"item-data":k,loading:e.isLoading,currency:r(y),"item-validation-scope":e.itemValidationScope,"invoice-items":e.store[e.storeProp].items,store:e.store,"store-prop":e.storeProp},null,8,["index","item-data","loading","currency","item-validation-scope","invoice-items","store","store-prop"]))]),_:1},8,["modelValue"])]),n("div",{class:"flex items-center justify-center w-full px-6 py-3 text-base border border-t-0 border-gray-200 border-solid cursor-pointer text-primary-400 hover:bg-primary-100",onClick:_[1]||(_[1]=(...k)=>e.store.addItem&&e.store.addItem(...k))},[s(P,{name:"PlusCircleIcon",class:"mr-2"}),j(" "+f(b.$t("general.add_new_item")),1)])],64)}}},qt={class:"flex items-center justify-between w-full mt-2 text-sm"},Lt={class:"font-semibold leading-5 text-gray-500 uppercase"},Et={class:"flex items-center justify-center text-lg text-black"},Ot={props:{index:{type:Number,required:!0},tax:{type:Object,required:!0},taxes:{type:Array,required:!0},currency:{type:[Object,String],required:!0},store:{type:Object,default:null},data:{type:String,default:""}},emits:["update","remove"],setup(e,{emit:o}){const t=e;te("$utils");const y=$(()=>t.tax.compound_tax&&t.store.getSubtotalWithDiscount?Math.round((t.store.getSubtotalWithDiscount+t.store.getTotalSimpleTax)*t.tax.percent/100):t.store.getSubtotalWithDiscount&&t.tax.percent?Math.round(t.store.getSubtotalWithDiscount*t.tax.percent/100):0);Pe(()=>{t.store.getSubtotalWithDiscount&&b(),t.store.getTotalSimpleTax&&b()});function b(){o("update",{...t.tax,amount:y.value})}return(_,w)=>{const d=m("BaseFormatMoney"),P=m("BaseIcon");return a(),p("div",qt,[n("label",Lt,f(e.tax.name)+" ("+f(e.tax.percent)+" %) ",1),n("label",Et,[s(d,{amount:e.tax.amount,currency:e.currency},null,8,["amount","currency"]),s(P,{name:"TrashIcon",class:"h-5 ml-2 cursor-pointer",onClick:w[0]||(w[0]=k=>_.$emit("remove",e.tax.id))})])])}}},Nt={class:"w-full mt-4 tax-select"},Ut={class:"relative w-full max-w-md px-4"},Ft={class:"overflow-hidden rounded-md shadow-lg ring-1 ring-black ring-opacity-5"},At={class:"relative bg-white"},zt={class:"relative p-4"},Wt={key:0,class:"relative flex flex-col overflow-auto list max-h-36 border-t border-gray-200"},Yt=["onClick"],Rt={class:"flex justify-between px-2"},Gt={class:"m-0 text-base font-semibold leading-tight text-gray-700 cursor-pointer"},Xt={class:"m-0 text-base font-semibold text-gray-700 cursor-pointer"},Ht={key:1,class:"flex justify-center p-5 text-gray-400"},Jt={class:"text-base text-gray-500 cursor-pointer"},Zt={class:"m-0 ml-3 text-sm leading-none cursor-pointer font-base text-primary-400"},Kt={props:{type:{type:String,default:null},store:{type:Object,default:null},storeProp:{type:String,default:""}},emits:["select:taxType"],setup(e,{emit:o}){const t=e,y=H(),b=ee(),_=ce(),{t:w}=J(),d=R(null),P=$(()=>d.value?b.taxTypes.filter(function(T){return T.name.toLowerCase().indexOf(d.value.toLowerCase())!==-1}):b.taxTypes),k=$(()=>t.store[t.storeProp].taxes);function M(T,l){o("select:taxType",{...T}),l()}function V(){y.openModal({title:w("settings.tax_types.add_tax"),componentName:"TaxTypeModal",size:"sm",refreshData:T=>o("select:taxType",T)})}return(T,l)=>{const h=m("BaseIcon"),c=m("BaseInput");return a(),p("div",Nt,[s(r(Me),{class:"relative"},{default:i(({isOpen:g})=>[s(r(ke),{class:A([g?"":"text-opacity-90","flex items-center text-sm font-medium text-primary-400 focus:outline-none focus:border-none"])},{default:i(()=>[s(h,{name:"PlusIcon",class:"w-4 h-4 font-medium text-primary-400"}),j(" "+f(T.$t("settings.tax_types.add_tax")),1)]),_:2},1032,["class"]),n("div",Ut,[s(Te,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:i(()=>[s(r(Ce),{style:{"min-width":"350px","margin-left":"62px",top:"-28px"},class:"absolute z-10 px-4 py-2 transform -translate-x-full sm:px-0"},{default:i(({close:C})=>[n("div",Ft,[n("div",At,[n("div",zt,[s(c,{modelValue:d.value,"onUpdate:modelValue":l[0]||(l[0]=x=>d.value=x),placeholder:T.$t("general.search"),type:"text",class:"text-black"},null,8,["modelValue","placeholder"])]),r(P).length>0?(a(),p("div",Wt,[(a(!0),p(G,null,X(r(P),(x,S)=>(a(),p("div",{key:S,class:A([{"bg-gray-100 cursor-not-allowed opacity-50 pointer-events-none":r(k).find(B=>B.tax_type_id===x.id)},"px-6 py-4 border-b border-gray-200 border-solid cursor-pointer hover:bg-gray-100 hover:cursor-pointer last:border-b-0"]),tabindex:"2",onClick:B=>M(x,C)},[n("div",Rt,[n("label",Gt,f(x.name),1),n("label",Xt,f(x.percent)+" % ",1)])],10,Yt))),128))])):(a(),p("div",Ht,[n("label",Jt,f(T.$t("general.no_tax_found")),1)]))]),r(_).hasAbilities(r(ue).CREATE_TAX_TYPE)?(a(),p("button",{key:0,type:"button",class:"flex items-center justify-center w-full h-10 px-2 py-3 bg-gray-200 border-none outline-none",onClick:V},[s(h,{name:"CheckCircleIcon",class:"text-primary-400"}),n("label",Zt,f(T.$t("estimates.add_new_tax")),1)])):L("",!0)])]),_:1})]),_:1})])]),_:1})])}}},Qt={class:"px-5 py-4 mt-6 bg-white border border-gray-200 border-solid rounded md:min-w-[390px] min-w-[300px] lg:mt-7"},eo={class:"flex items-center justify-between w-full"},to={key:1,class:"text-sm font-semibold leading-5 text-gray-400 uppercase"},oo={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},no={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-500 uppercase"},so={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},ao={key:0,class:"flex items-center justify-between w-full mt-2"},ro={key:1,class:"text-sm font-semibold leading-5 text-gray-400 uppercase"},lo={key:3,class:"flex",style:{width:"140px"},role:"group"},io={class:"flex items-center"},co={key:1},uo={class:"flex items-center justify-between w-full pt-2 mt-5 border-t border-gray-200 border-solid"},mo={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-400 uppercase"},po={key:3,class:"flex items-center justify-center text-lg uppercase text-primary-400"},Lo={props:{store:{type:Object,default:null},storeProp:{type:String,default:""},taxPopupType:{type:String,default:""},currency:{type:[Object,String],default:""},isLoading:{type:Boolean,default:!1}},setup(e){const o=e,t=R(null);te("$utils");const y=Q(),b=$({get:()=>o.store[o.storeProp].discount,set:l=>{o.store[o.storeProp].discount_type==="percentage"?o.store[o.storeProp].discount_val=Math.round(o.store.getSubTotal*l/100):o.store[o.storeProp].discount_val=Math.round(l*100),o.store[o.storeProp].discount=l}}),_=$({get:()=>o.store[o.storeProp].taxes,set:l=>{o.store.$patch(h=>{h[o.storeProp].taxes=l})}}),w=$(()=>{let l=[];return o.store[o.storeProp].items.forEach(h=>{h.taxes&&h.taxes.forEach(c=>{let g=l.find(C=>C.tax_type_id===c.tax_type_id);g?g.amount+=c.amount:c.tax_type_id&&l.push({tax_type_id:c.tax_type_id,amount:c.amount,percent:c.percent,name:c.name})})}),l}),d=$(()=>o.currency?o.currency:y.selectedCompanyCurrency);function P(){o.store[o.storeProp].discount_type!=="fixed"&&(o.store[o.storeProp].discount_val=Math.round(o.store[o.storeProp].discount*100),o.store[o.storeProp].discount_type="fixed")}function k(){o.store[o.storeProp].discount_type!=="percentage"&&(o.store[o.storeProp].discount_val=o.store.getSubTotal*o.store[o.storeProp].discount/100,o.store[o.storeProp].discount_type="percentage")}function M(l){let h=0;l.compound_tax&&o.store.getSubtotalWithDiscount?h=Math.round((o.store.getSubtotalWithDiscount+o.store.getTotalSimpleTax)*l.percent/100):o.store.getSubtotalWithDiscount&&l.percent&&(h=Math.round(o.store.getSubtotalWithDiscount*l.percent/100));let c={...me,id:ye.raw(),name:l.name,percent:l.percent,compound_tax:l.compound_tax,tax_type_id:l.id,amount:h};o.store.$patch(g=>{g[o.storeProp].taxes.push({...c})})}function V(l){const h=o.store[o.storeProp].taxes.find(c=>c.id===l.id);h&&Object.assign(h,{...l})}function T(l){const h=o.store[o.storeProp].taxes.findIndex(c=>c.id===l);o.store.$patch(c=>{c[o.storeProp].taxes.splice(h,1)})}return(l,h)=>{const c=m("BaseContentPlaceholdersText"),g=m("BaseContentPlaceholders"),C=m("BaseFormatMoney"),x=m("BaseInput"),S=m("BaseIcon"),B=m("BaseButton"),z=m("BaseDropdownItem"),F=m("BaseDropdown");return a(),p("div",Qt,[n("div",eo,[e.isLoading?(a(),I(g,{key:0},{default:i(()=>[s(c,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),p("label",to,f(l.$t("estimates.sub_total")),1)),e.isLoading?(a(),I(g,{key:2},{default:i(()=>[s(c,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),p("label",oo,[s(C,{amount:e.store.getSubTotal,currency:r(d)},null,8,["amount","currency"])]))]),(a(!0),p(G,null,X(r(w),D=>(a(),p("div",{key:D.tax_type_id,class:"flex items-center justify-between w-full"},[e.isLoading?(a(),I(g,{key:0},{default:i(()=>[s(c,{lines:1,class:"w-16 h-5"})]),_:1})):e.store[e.storeProp].tax_per_item==="YES"?(a(),p("label",no,f(D.name)+" - "+f(D.percent)+"% ",1)):L("",!0),e.isLoading?(a(),I(g,{key:2},{default:i(()=>[s(c,{lines:1,class:"w-16 h-5"})]),_:1})):e.store[e.storeProp].tax_per_item==="YES"?(a(),p("label",so,[s(C,{amount:D.amount,currency:r(d)},null,8,["amount","currency"])])):L("",!0)]))),128)),e.store[e.storeProp].discount_per_item==="NO"||e.store[e.storeProp].discount_per_item===null?(a(),p("div",ao,[e.isLoading?(a(),I(g,{key:0},{default:i(()=>[s(c,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),p("label",ro,f(l.$t("estimates.discount")),1)),e.isLoading?(a(),I(g,{key:2},{default:i(()=>[s(c,{lines:1,class:"w-24 h-8 rounded-md border"})]),_:1})):(a(),p("div",lo,[s(x,{modelValue:r(b),"onUpdate:modelValue":h[0]||(h[0]=D=>Y(b)?b.value=D:null),class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-br-sm h-[38px]"},null,8,["modelValue"]),s(F,{position:"bottom-end"},{activator:i(()=>[s(B,{class:"rounded-tr-md rounded-br-md p-2 rounded-none",type:"button",variant:"white"},{default:i(()=>[n("span",io,[j(f(e.store[e.storeProp].discount_type=="fixed"?r(d).symbol:"%")+" ",1),s(S,{name:"ChevronDownIcon",class:"w-4 h-4 text-gray-500 ml-1"})])]),_:1})]),default:i(()=>[s(z,{onClick:P},{default:i(()=>[j(f(l.$t("general.fixed")),1)]),_:1}),s(z,{onClick:k},{default:i(()=>[j(f(l.$t("general.percentage")),1)]),_:1})]),_:1})]))])):L("",!0),e.store[e.storeProp].tax_per_item==="NO"||e.store[e.storeProp].tax_per_item===null?(a(),p("div",co,[(a(!0),p(G,null,X(r(_),(D,q)=>(a(),I(Ot,{key:D.id,index:q,tax:D,taxes:r(_),currency:e.currency,store:e.store,onRemove:T,onUpdate:V},null,8,["index","tax","taxes","currency","store"]))),128))])):L("",!0),e.store[e.storeProp].tax_per_item==="NO"||e.store[e.storeProp].tax_per_item===null?(a(),p("div",{key:2,ref_key:"taxModal",ref:t,class:"float-right pt-2 pb-4"},[s(Kt,{"store-prop":e.storeProp,store:e.store,type:e.taxPopupType,"onSelect:taxType":M},null,8,["store-prop","store","type"])],512)):L("",!0),n("div",uo,[e.isLoading?(a(),I(g,{key:0},{default:i(()=>[s(c,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),p("label",mo,f(l.$t("estimates.total"))+" "+f(l.$t("estimates.amount"))+":",1)),e.isLoading?(a(),I(g,{key:2},{default:i(()=>[s(c,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),p("label",po,[s(C,{amount:e.store.getTotal,currency:r(d)},null,8,["amount","currency"])]))])])}}},yo={class:"flex text-primary-800 font-medium text-sm mb-2"},xo=n("span",{class:"text-sm text-red-500"}," *",-1),Eo={props:{store:{type:Object,default:null},storeProp:{type:String,default:""}},setup(e){const o=e,t=H(),{t:y}=J();function b(){t.openModal({title:y("general.choose_template"),componentName:"SelectTemplate",data:{templates:o.store.templates,store:o.store,storeProp:o.storeProp}})}return(_,w)=>{const d=m("BaseIcon"),P=m("BaseButton");return a(),p("div",null,[n("label",yo,[j(f(_.$t("general.select_template"))+" ",1),xo]),s(P,{type:"button",class:"flex justify-center w-full text-sm lg:w-auto hover:bg-gray-200",variant:"gray",onClick:b},{right:i(k=>[s(d,{name:"PencilIcon",class:A(k.class)},null,8,["class"])]),default:i(()=>[j(" "+f(e.store[e.storeProp].template_name),1)]),_:1})])}}},fo={class:"mb-6"},ho={class:"z-20 text-sm font-semibold leading-5 text-primary-400 float-right"},go={class:"text-primary-800 font-medium mb-4 text-sm"},Oo={props:{store:{type:Object,default:null},storeProp:{type:String,default:""},fields:{type:Object,default:null},type:{type:String,default:null}},setup(e){const o=e;function t(y){o.store[o.storeProp].notes=""+y.notes}return(y,b)=>{const _=m("BaseCustomInput");return a(),p("div",fo,[n("div",ho,[s(qe,{type:e.type,onSelect:t},null,8,["type"])]),n("label",go,f(y.$t("invoices.notes")),1),s(_,{modelValue:e.store[e.storeProp].notes,"onUpdate:modelValue":b[0]||(b[0]=w=>e.store[e.storeProp].notes=w),"content-loading":e.store.isFetchingInitialSettings,fields:e.fields,class:"mt-1"},null,8,["modelValue","content-loading","fields"])])}}};var bo="/img/tick.png";const _o={class:"flex justify-between w-full"},vo={class:"px-8 py-8 sm:p-6"},$o={key:0,class:"grid grid-cols-3 gap-2 p-1 overflow-x-auto"},wo=["src","alt","onClick"],Bo=["alt"],Io={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},No={setup(e){const o=H(),t=R(""),y=$(()=>o.active&&o.componentName==="SelectTemplate"),b=$(()=>o.title);function _(){o.data.store[o.data.storeProp].template_name?t.value=o.data.store[o.data.storeProp].template_name:t.value=o.data.templates[0]}async function w(){await o.data.store.setTemplate(t.value),d()}function d(){o.closeModal(),setTimeout(()=>{o.$reset()},300)}return(P,k)=>{const M=m("BaseIcon"),V=m("BaseButton"),T=m("BaseModal");return a(),I(T,{show:r(y),onClose:d,onOpen:_},{header:i(()=>[n("div",_o,[j(f(r(b))+" ",1),s(M,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:d})])]),default:i(()=>[n("div",vo,[r(o).data?(a(),p("div",$o,[(a(!0),p(G,null,X(r(o).data.templates,(l,h)=>(a(),p("div",{key:h,class:A([{"border border-solid border-primary-500":t.value===l.name},"relative flex flex-col m-2 border border-gray-200 border-solid cursor-pointer hover:border-primary-300"])},[n("img",{src:l.path,alt:l.name,class:"w-full",onClick:c=>t.value=l.name},null,8,wo),t.value===l.name?(a(),p("img",{key:0,alt:l.name,class:"absolute z-10 w-5 h-5 text-primary-500",style:{top:"-6px",right:"-5px"},src:bo},null,8,Bo)):L("",!0),n("span",{class:A(["w-full p-1 bg-gray-200 text-sm text-center absolute bottom-0 left-0",{"text-primary-500 bg-primary-100":t.value===l.name,"text-gray-600":t.value!=l.name}])},f(l.name),3)],2))),128))])):L("",!0)]),n("div",Io,[s(V,{class:"mr-3",variant:"primary-outline",onClick:d},{default:i(()=>[j(f(P.$t("general.cancel")),1)]),_:1}),s(V,{variant:"primary",onClick:k[0]||(k[0]=l=>w())},{left:i(l=>[s(M,{name:"SaveIcon",class:A(l.class)},null,8,["class"])]),default:i(()=>[j(" "+f(P.$t("general.choose")),1)]),_:1})])]),_:1},8,["show"])}}},So={class:"flex justify-between w-full"},Po={class:"item-modal"},ko=["onSubmit"],To={class:"px-8 py-8 sm:p-6"},Co={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Uo={emits:["newItem"],setup(e,{emit:o}){const t=H(),y=de(),b=Q(),_=ee();be(),_e();const{t:w}=J(),d=R(!1),P=R(b.selectedCompanySettings.tax_per_item),k=$(()=>t.active&&t.componentName==="ItemModal"),M=$({get:()=>y.currentItem.price/100,set:x=>{y.currentItem.price=Math.round(x*100)}}),V=$({get:()=>y.currentItem.taxes.map(x=>{if(x)return{...x,tax_type_id:x.id,tax_name:x.name+" ("+x.percent+"%)"}}),set:x=>{y.$patch(S=>{S.currentItem.taxes=x})}}),T=$(()=>P.value==="YES"),l={name:{required:N.withMessage(w("validation.required"),Z),minLength:N.withMessage(w("validation.name_min_length",{count:3}),De(3))},description:{maxLength:N.withMessage(w("validation.description_maxlength",{count:255}),K(255))}},h=pe(l,$(()=>y.currentItem)),c=$(()=>_.taxTypes.map(x=>({...x,tax_name:x.name+" ("+x.percent+"%)"})));je(()=>{h.value.$reset(),y.fetchItemUnits({limit:"all"})});async function g(){if(h.value.$touch(),h.value.$invalid)return!0;let x={...y.currentItem,taxes:y.currentItem.taxes.map(B=>({tax_type_id:B.id,amount:M.value*B.percent/100,percent:B.percent,name:B.name,collective_tax:0}))};d.value=!0,await(y.isEdit?y.updateItem:y.addItem)(x).then(B=>{d.value=!1,B.data.data&&t.data&&t.refreshData(B.data.data),C()})}function C(){t.closeModal(),setTimeout(()=>{y.resetCurrentItem(),t.$reset(),h.value.$reset()},300)}return(x,S)=>{const B=m("BaseIcon"),z=m("BaseInput"),F=m("BaseInputGroup"),D=m("BaseMoney"),q=m("BaseMultiselect"),u=m("BaseTextarea"),v=m("BaseInputGrid"),O=m("BaseButton"),W=m("BaseModal");return a(),I(W,{show:r(k),onClose:C},{header:i(()=>[n("div",So,[j(f(r(t).title)+" ",1),s(B,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:C})])]),default:i(()=>[n("div",Po,[n("form",{action:"",onSubmit:Ve(g,["prevent"])},[n("div",To,[s(v,{layout:"one-column"},{default:i(()=>[s(F,{label:x.$t("items.name"),required:"",error:r(h).name.$error&&r(h).name.$errors[0].$message},{default:i(()=>[s(z,{modelValue:r(y).currentItem.name,"onUpdate:modelValue":S[0]||(S[0]=E=>r(y).currentItem.name=E),type:"text",invalid:r(h).name.$error,onInput:S[1]||(S[1]=E=>r(h).name.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),s(F,{label:x.$t("items.price")},{default:i(()=>[(a(),I(D,{key:r(b).selectedCompanyCurrency,modelValue:r(M),"onUpdate:modelValue":S[2]||(S[2]=E=>Y(M)?M.value=E:null),currency:r(b).selectedCompanyCurrency,class:"relative w-full focus:border focus:border-solid focus:border-primary"},null,8,["modelValue","currency"]))]),_:1},8,["label"]),s(F,{label:x.$t("items.unit")},{default:i(()=>[s(q,{modelValue:r(y).currentItem.unit_id,"onUpdate:modelValue":S[3]||(S[3]=E=>r(y).currentItem.unit_id=E),label:"name",options:r(y).itemUnits,"value-prop":"id","can-deselect":!1,"can-clear":!1,placeholder:x.$t("items.select_a_unit"),searchable:"","track-by":"id"},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),r(T)?(a(),I(F,{key:0,label:x.$t("items.taxes")},{default:i(()=>[s(q,{modelValue:r(V),"onUpdate:modelValue":S[4]||(S[4]=E=>Y(V)?V.value=E:null),options:r(c),label:"name","value-prop":"id",class:"w-full","can-deselect":!1,"can-clear":!1,searchable:"","track-by":"id",object:""},null,8,["modelValue","options"])]),_:1},8,["label"])):L("",!0),s(F,{label:x.$t("items.description"),error:r(h).description.$error&&r(h).description.$errors[0].$message},{default:i(()=>[s(u,{modelValue:r(y).currentItem.description,"onUpdate:modelValue":S[5]||(S[5]=E=>r(y).currentItem.description=E),rows:"4",cols:"50",invalid:r(h).description.$error,onInput:S[6]||(S[6]=E=>r(h).description.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"])]),_:1})]),n("div",Co,[s(O,{class:"mr-3",variant:"primary-outline",type:"button",onClick:C},{default:i(()=>[j(f(x.$t("general.cancel")),1)]),_:1}),s(O,{loading:d.value,disabled:d.value,variant:"primary",type:"submit"},{left:i(E=>[s(B,{name:"SaveIcon",class:A(E.class)},null,8,["class"])]),default:i(()=>[j(" "+f(r(y).isEdit?x.$t("general.update"):x.$t("general.save")),1)]),_:1},8,["loading","disabled"])])],40,ko)])]),_:1},8,["show"])}}};export{No as _,Uo as a,qo as b,Oo as c,Eo as d,Lo as e};
