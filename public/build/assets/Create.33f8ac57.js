import{u as le,C as ue,am as me,g as ie,i as V,j as ce,k as I,m as $,n as C,aZ as de,aU as ye,L as pe,q as _e,ac as ve,b3 as fe,r as u,o as w,c as Pe,b as r,w as s,t as h,y as e,s as q,z as E,A as F,v as M,x as f,a0 as ge,B as be,F as Be}from"./vendor.d8bc4b48.js";import{_ as $e}from"./ExchangeRateConverter.aa5d19bc.js";import{o as he,u as Ie,k as Se,l as Ve,c as Ce,g as we,f as Me,m as qe}from"./main.90d606cc.js";import{_ as ke}from"./SelectNotePopup.28912ac9.js";import{_ as Ue}from"./CreateCustomFields.24725e49.js";import{_ as Ne}from"./PaymentModeModal.3ebb6f1d.js";import"./NoteModal.1222fe10.js";const Ae=["onSubmit"],De={class:"absolute left-3.5"},xe={class:"relative w-full"},Ee={class:"relative mt-6"},Fe={class:"z-20 float-right text-sm font-semibold leading-5 text-primary-400"},Ge={class:"mb-4 text-sm font-medium text-primary-800"},Ke={setup(Le){const d=le(),G=ue(),t=he();Ie();const L=Se();Ve(),Ce();const R=we(),k=Me();qe();const U=me("utils"),{t:y}=ie();let P=V(!1),S=V(!1),p=V([]);const _=V(null),N="newEstimate",j=ce(["customer","company","customerCustom","payment","paymentCustom"]),b=I({get:()=>t.currentPayment.amount/100,set:n=>{t.currentPayment.amount=Math.round(n*100)}}),l=I(()=>t.isFetchingInitialData),i=I(()=>d.name==="payments.edit"),A=I(()=>i.value?y("payments.edit_payment"):y("payments.new_payment")),z=I(()=>({currentPayment:{customer_id:{required:$.withMessage(y("validation.required"),C)},payment_date:{required:$.withMessage(y("validation.required"),C)},amount:{required:$.withMessage(y("validation.required"),C),between:$.withMessage(y("validation.payment_greater_than_due_amount"),de(0,t.currentPayment.maxPayableAmount))},exchange_rate:{required:ye(function(){return $.withMessage(y("validation.required"),C),t.showExchangeRate}),decimal:$.withMessage(y("validation.valid_exchange_rate"),pe)}}})),m=_e(z,t,{$scope:N});ve(()=>{t.currentPayment.customer_id&&K(t.currentPayment.customer_id),d.query.customer&&(t.currentPayment.customer_id=d.query.customer)}),t.resetCurrentPayment(),d.query.customer&&(t.currentPayment.customer_id=d.query.customer),t.fetchPaymentInitialData(i.value),d.params.id&&!i.value&&Z();async function H(){R.openModal({title:y("settings.payment_modes.add_payment_mode"),componentName:"PaymentModeModal"})}function T(n){t.currentPayment.notes=""+n.notes}async function Z(){let n=await k.fetchInvoice(d?.params?.id);t.currentPayment.customer_id=n.data.data.customer.id,t.currentPayment.invoice_id=n.data.data.id}async function J(n){n&&(_.value=p.value.find(a=>a.id===n),b.value=_.value.due_amount/100,t.currentPayment.maxPayableAmount=_.value.due_amount)}function K(n){if(n){let a={customer_id:n,status:"DUE",limit:"all"};i.value&&(a.status=""),S.value=!0,Promise.all([k.fetchInvoices(a),L.fetchCustomer(n)]).then(async([c,g])=>{c&&(p.value=[...c.data.data]),g&&g.data&&(t.currentPayment.selectedCustomer=g.data.data,t.currentPayment.customer=g.data.data,t.currentPayment.currency=g.data.data.currency),t.currentPayment.invoice_id&&(_.value=p.value.find(v=>v.id===t.currentPayment.invoice_id),t.currentPayment.maxPayableAmount=_.value.due_amount+t.currentPayment.amount,b.value===0&&(b.value=_.value.due_amount/100)),i.value&&(p.value=p.value.filter(v=>v.due_amount>0||v.id==t.currentPayment.invoice_id)),S.value=!1}).catch(c=>{S.value=!1,console.error(c,"error")})}}fe(()=>{t.resetCurrentPayment(),p.value=[]});async function O(){if(m.value.$touch(),m.value.$invalid)return!1;P.value=!0;let n={...t.currentPayment},a=null;try{a=await(i.value?t.updatePayment:t.addPayment)(n),G.push(`/admin/payments/${a.data.data.id}/view`)}catch{P.value=!1}}function Q(n){let a={userId:n};d.params.id&&(a.model_id=d.params.id),t.currentPayment.invoice_id=_.value=null,t.currentPayment.amount=0,p.value=[],t.getNextNumber(a,!0)}return(n,a)=>{const c=u("BaseBreadcrumbItem"),g=u("BaseBreadcrumb"),v=u("BaseIcon"),D=u("BaseButton"),W=u("BasePageHeader"),X=u("BaseDatePicker"),B=u("BaseInputGroup"),Y=u("BaseInput"),ee=u("BaseCustomerSelectInput"),x=u("BaseMultiselect"),te=u("BaseMoney"),ne=u("BaseSelectAction"),ae=u("BaseInputGrid"),oe=u("BaseCustomInput"),re=u("BaseCard"),se=u("BasePage");return w(),Pe(Be,null,[r(Ne),r(se,{class:"relative payment-create"},{default:s(()=>[h("form",{action:"",onSubmit:be(O,["prevent"])},[r(W,{title:e(A),class:"mb-5"},{actions:s(()=>[r(D,{loading:e(P),disabled:e(P),variant:"primary",type:"submit",class:"hidden sm:flex"},{left:s(o=>[e(P)?F("",!0):(w(),q(v,{key:0,name:"SaveIcon",class:E(o.class)},null,8,["class"]))]),default:s(()=>[M(" "+f(e(i)?n.$t("payments.update_payment"):n.$t("payments.save_payment")),1)]),_:1},8,["loading","disabled"])]),default:s(()=>[r(g,null,{default:s(()=>[r(c,{title:n.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),r(c,{title:n.$tc("payments.payment",2),to:"/admin/payments"},null,8,["title"]),r(c,{title:e(A),to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),r(re,null,{default:s(()=>[r(ae,null,{default:s(()=>[r(B,{label:n.$t("payments.date"),"content-loading":e(l),required:"",error:e(m).currentPayment.payment_date.$error&&e(m).currentPayment.payment_date.$errors[0].$message},{default:s(()=>[r(X,{modelValue:e(t).currentPayment.payment_date,"onUpdate:modelValue":[a[0]||(a[0]=o=>e(t).currentPayment.payment_date=o),a[1]||(a[1]=o=>e(m).currentPayment.payment_date.$touch())],"content-loading":e(l),"calendar-button":!0,"calendar-button-icon":"calendar",invalid:e(m).currentPayment.payment_date.$error},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","error"]),r(B,{label:n.$t("payments.payment_number"),"content-loading":e(l),required:""},{default:s(()=>[r(Y,{modelValue:e(t).currentPayment.payment_number,"onUpdate:modelValue":a[2]||(a[2]=o=>e(t).currentPayment.payment_number=o),"content-loading":e(l)},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),r(B,{label:n.$t("payments.customer"),error:e(m).currentPayment.customer_id.$error&&e(m).currentPayment.customer_id.$errors[0].$message,"content-loading":e(l),required:""},{default:s(()=>[r(ee,{modelValue:e(t).currentPayment.customer_id,"onUpdate:modelValue":[a[3]||(a[3]=o=>e(t).currentPayment.customer_id=o),a[4]||(a[4]=o=>Q(e(t).currentPayment.customer_id))],"content-loading":e(l),invalid:e(m).currentPayment.customer_id.$error,placeholder:n.$t("customers.select_a_customer"),"fetch-all":e(i),"show-action":""},null,8,["modelValue","content-loading","invalid","placeholder","fetch-all"])]),_:1},8,["label","error","content-loading"]),r(B,{"content-loading":e(l),label:n.$t("payments.invoice"),"help-text":_.value?`Due Amount: ${e(t).currentPayment.maxPayableAmount/100}`:""},{default:s(()=>[r(x,{modelValue:e(t).currentPayment.invoice_id,"onUpdate:modelValue":a[5]||(a[5]=o=>e(t).currentPayment.invoice_id=o),"content-loading":e(l),"value-prop":"id","track-by":"invoice_number",label:"invoice_number",options:e(p),loading:e(S),placeholder:n.$t("invoices.select_invoice"),onSelect:J},{singlelabel:s(({value:o})=>[h("div",De,f(o.invoice_number)+" ("+f(e(U).formatMoney(o.total,o.customer.currency))+") ",1)]),option:s(({option:o})=>[M(f(o.invoice_number)+" ("+f(e(U).formatMoney(o.total,o.customer.currency))+") ",1)]),_:1},8,["modelValue","content-loading","options","loading","placeholder"])]),_:1},8,["content-loading","label","help-text"]),r(B,{label:n.$t("payments.amount"),"content-loading":e(l),error:e(m).currentPayment.amount.$error&&e(m).currentPayment.amount.$errors[0].$message,required:""},{default:s(()=>[h("div",xe,[(w(),q(te,{key:e(t).currentPayment.currency,modelValue:e(b),"onUpdate:modelValue":[a[6]||(a[6]=o=>ge(b)?b.value=o:null),a[7]||(a[7]=o=>e(m).currentPayment.amount.$touch())],currency:e(t).currentPayment.currency,"content-loading":e(l),invalid:e(m).currentPayment.amount.$error},null,8,["modelValue","currency","content-loading","invalid"]))])]),_:1},8,["label","content-loading","error"]),r(B,{"content-loading":e(l),label:n.$t("payments.payment_mode")},{default:s(()=>[r(x,{modelValue:e(t).currentPayment.payment_method_id,"onUpdate:modelValue":a[8]||(a[8]=o=>e(t).currentPayment.payment_method_id=o),"content-loading":e(l),label:"name","value-prop":"id","track-by":"name",options:e(t).paymentModes,placeholder:n.$t("payments.select_payment_mode"),searchable:""},{action:s(()=>[r(ne,{onClick:H},{default:s(()=>[r(v,{name:"PlusIcon",class:"h-4 mr-2 -ml-2 text-center text-primary-400"}),M(" "+f(n.$t("settings.payment_modes.add_payment_mode")),1)]),_:1})]),_:1},8,["modelValue","content-loading","options","placeholder"])]),_:1},8,["content-loading","label"]),r($e,{store:e(t),"store-prop":"currentPayment",v:e(m).currentPayment,"is-loading":e(l),"is-edit":e(i),"customer-currency":e(t).currentPayment.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])]),_:1}),r(Ue,{type:"Payment","is-edit":e(i),"is-loading":e(l),store:e(t),"store-prop":"currentPayment","custom-field-scope":N,class:"mt-6"},null,8,["is-edit","is-loading","store"]),h("div",Ee,[h("div",Fe,[r(ke,{type:"Payment",onSelect:T})]),h("label",Ge,f(n.$t("estimates.notes")),1),r(oe,{modelValue:e(t).currentPayment.notes,"onUpdate:modelValue":a[9]||(a[9]=o=>e(t).currentPayment.notes=o),"content-loading":e(l),fields:e(j),class:"mt-1"},null,8,["modelValue","content-loading","fields"])]),r(D,{loading:e(P),"content-loading":e(l),variant:"primary",type:"submit",class:"flex justify-center w-full mt-4 sm:hidden md:hidden"},{left:s(o=>[e(P)?F("",!0):(w(),q(v,{key:0,name:"SaveIcon",class:E(o.class)},null,8,["class"]))]),default:s(()=>[M(" "+f(e(i)?n.$t("payments.update_payment"):n.$t("payments.save_payment")),1)]),_:1},8,["loading","content-loading"])]),_:1})],40,Ae)]),_:1})],64)}}};export{Ke as default};
