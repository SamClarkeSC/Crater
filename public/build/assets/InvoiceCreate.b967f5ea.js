import{r as a,o as v,c as P,b as t,y as n,w as s,g as z,u as H,C as A,i as q,k as h,m as u,n as w,a4 as O,aU as J,L as K,q as Q,D as W,t as y,s as S,x as k,A as L,z as X,v as Y,B as Z,F as ee}from"./vendor.d8bc4b48.js";import{f as F,c as ne,l as te}from"./main.90d606cc.js";import{_ as oe,a as ie,b as ae,c as se,d as le,e as ce}from"./ItemModal.33f61cf4.js";import{_ as re}from"./ExchangeRateConverter.aa5d19bc.js";import{_ as de}from"./CreateCustomFields.24725e49.js";import{_ as ue}from"./TaxTypeModal.8d4cfdb0.js";import"./DragIcon.a86580cb.js";import"./SelectNotePopup.28912ac9.js";import"./NoteModal.1222fe10.js";const me={class:"grid grid-cols-12 gap-8 mt-6 mb-8"},ve={props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(o){const e=F();return(g,l)=>{const c=a("BaseCustomerSelectPopup"),b=a("BaseDatePicker"),p=a("BaseInputGroup"),_=a("BaseInput"),d=a("BaseInputGrid");return v(),P("div",me,[t(c,{modelValue:n(e).newInvoice.customer,"onUpdate:modelValue":l[0]||(l[0]=r=>n(e).newInvoice.customer=r),valid:o.v.customer_id,"content-loading":o.isLoading,type:"invoice",class:"col-span-12 lg:col-span-5 pr-0"},null,8,["modelValue","valid","content-loading"]),t(d,{class:"col-span-12 lg:col-span-7"},{default:s(()=>[t(p,{label:g.$t("invoices.invoice_date"),"content-loading":o.isLoading,required:"",error:o.v.invoice_date.$error&&o.v.invoice_date.$errors[0].$message},{default:s(()=>[t(b,{modelValue:n(e).newInvoice.invoice_date,"onUpdate:modelValue":l[1]||(l[1]=r=>n(e).newInvoice.invoice_date=r),"content-loading":o.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),t(p,{label:g.$t("invoices.due_date"),"content-loading":o.isLoading,required:"",error:o.v.due_date.$error&&o.v.due_date.$errors[0].$message},{default:s(()=>[t(b,{modelValue:n(e).newInvoice.due_date,"onUpdate:modelValue":l[2]||(l[2]=r=>n(e).newInvoice.due_date=r),"content-loading":o.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),t(p,{label:g.$t("invoices.invoice_number"),"content-loading":o.isLoading,error:o.v.invoice_number.$error&&o.v.invoice_number.$errors[0].$message,required:""},{default:s(()=>[t(_,{modelValue:n(e).newInvoice.invoice_number,"onUpdate:modelValue":l[3]||(l[3]=r=>n(e).newInvoice.invoice_number=r),"content-loading":o.isLoading,onInput:l[4]||(l[4]=r=>o.v.invoice_number.$touch())},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),t(re,{store:n(e),"store-prop":"newInvoice",v:o.v,"is-loading":o.isLoading,"is-edit":o.isEdit,"customer-currency":n(e).newInvoice.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])]),_:1})])}}},ge=["onSubmit"],pe={class:"flex"},_e={class:"block mt-10 invoice-foot lg:flex lg:justify-between lg:items-start"},fe={class:"relative w-full lg:w-1/2 lg:mr-4"},Ie={class:"flex"},qe={setup(o){const e=F(),g=ne(),l=te(),{t:c}=z();let b=H(),p=A();const _="newInvoice";let d=q(!1);const r=q(["customer","company","customerCustom","invoice","invoiceCustom"]);let $=h(()=>e.isFetchingInvoice||e.isFetchingInitialSettings),M=h(()=>f.value?c("invoices.edit_invoice"):c("invoices.new_invoice")),f=h(()=>b.name==="invoices.edit");const x={invoice_date:{required:u.withMessage(c("validation.required"),w)},due_date:{required:u.withMessage(c("validation.required"),w)},reference_number:{maxLength:u.withMessage(c("validation.price_maxlength"),O(255))},customer_id:{required:u.withMessage(c("validation.required"),w)},invoice_number:{required:u.withMessage(c("validation.required"),w)},exchange_rate:{required:J(function(){return u.withMessage(c("validation.required"),w),e.showExchangeRate}),decimal:u.withMessage(c("validation.valid_exchange_rate"),K)}},B=Q(x,h(()=>e.newInvoice),{$scope:_});l.resetCustomFields(),B.value.$reset,e.resetCurrentInvoice(),e.fetchInvoiceInitialSettings(f.value),W(()=>e.newInvoice.customer,i=>{i&&i.currency?e.newInvoice.selectedCurrency=i.currency:e.newInvoice.selectedCurrency=g.selectedCompanyCurrency});async function T(){if(B.value.$touch(),B.value.$invalid)return!1;d.value=!0;let i={...e.newInvoice,sub_total:e.getSubTotal,total:e.getTotal,tax:e.getTotalTax};try{const m=await(f.value?e.updateInvoice:e.addInvoice)(i);p.push(`/admin/invoices/${m.data.data.id}/view`)}catch(I){console.error(I)}d.value=!1}return(i,I)=>{const m=a("BaseBreadcrumbItem"),U=a("BaseBreadcrumb"),V=a("BaseButton"),D=a("router-link"),E=a("BaseIcon"),N=a("BasePageHeader"),G=a("BaseSwitchSection"),R=a("BaseScrollPane"),j=a("BasePage");return v(),P(ee,null,[t(oe),t(ie),t(ue),t(j,{class:"relative invoice-create-page"},{default:s(()=>[y("form",{onSubmit:Z(T,["prevent"])},[t(N,{title:n(M)},{actions:s(()=>[i.$route.name==="invoices.edit"?(v(),S(D,{key:0,to:`/invoices/pdf/${n(e).newInvoice.unique_hash}`,target:"_blank"},{default:s(()=>[t(V,{class:"mr-3",variant:"primary-outline",type:"button"},{default:s(()=>[y("span",pe,k(i.$t("general.view_pdf")),1)]),_:1})]),_:1},8,["to"])):L("",!0),t(V,{loading:n(d),disabled:n(d),variant:"primary",type:"submit"},{left:s(C=>[n(d)?L("",!0):(v(),S(E,{key:0,name:"SaveIcon",class:X(C.class)},null,8,["class"]))]),default:s(()=>[Y(" "+k(i.$t("invoices.save_invoice")),1)]),_:1},8,["loading","disabled"])]),default:s(()=>[t(U,null,{default:s(()=>[t(m,{title:i.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),t(m,{title:i.$tc("invoices.invoice",2),to:"/admin/invoices"},null,8,["title"]),i.$route.name==="invoices.edit"?(v(),S(m,{key:0,title:i.$t("invoices.edit_invoice"),to:"#",active:""},null,8,["title"])):(v(),S(m,{key:1,title:i.$t("invoices.new_invoice"),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),t(ve,{v:n(B),"is-loading":n($),"is-edit":n(f)},null,8,["v","is-loading","is-edit"]),t(R,null,{default:s(()=>[t(ae,{currency:n(e).newInvoice.selectedCurrency,"is-loading":n($),"item-validation-scope":_,store:n(e),"store-prop":"newInvoice"},null,8,["currency","is-loading","store"]),y("div",_e,[y("div",fe,[t(se,{store:n(e),"store-prop":"newInvoice",fields:r.value,type:"Invoice"},null,8,["store","fields"]),t(de,{type:"Invoice","is-edit":n(f),"is-loading":n($),store:n(e),"store-prop":"newInvoice","custom-field-scope":_,class:"mb-6"},null,8,["is-edit","is-loading","store"]),t(le,{store:n(e),"store-prop":"newInvoice","component-name":"InvoiceTemplate"},null,8,["store"]),y("div",Ie,[t(G,{modelValue:n(e).newInvoice.display_due_amount,"onUpdate:modelValue":I[0]||(I[0]=C=>n(e).newInvoice.display_due_amount=C),title:"Display due amount in invoice?"},null,8,["modelValue"])])]),t(ce,{currency:n(e).newInvoice.selectedCurrency,"is-loading":n($),store:n(e),"store-prop":"newInvoice","tax-popup-type":"invoice"},null,8,["currency","is-loading","store"])])]),_:1})],40,ge)]),_:1})],64)}}};export{qe as default};
