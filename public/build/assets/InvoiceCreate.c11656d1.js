var J=Object.defineProperty,K=Object.defineProperties;var Q=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var k=(t,e,i)=>e in t?J(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,L=(t,e)=>{for(var i in e||(e={}))W.call(e,i)&&k(t,i,e[i]);if(q)for(var i of q(e))X.call(e,i)&&k(t,i,e[i]);return t},j=(t,e)=>K(t,Q(e));import{r as s,o as g,c as M,b as o,y as n,w as l,g as Y,u as Z,C as ee,i as P,k as h,m,n as w,a4 as ne,aU as te,O as oe,q as ie,D as ae,t as b,s as S,x as F,A as x,z as se,v as le,B as ce,F as re}from"./vendor.aee1ea50.js";import{f as T,c as de,l as ue}from"./main.b124d86b.js";import{_ as me,a as ve,b as ge,c as pe,d as _e,e as fe}from"./ItemModal.639add9d.js";import{_ as Ie}from"./ExchangeRateConverter.fc6e1714.js";import{_ as we}from"./CreateCustomFields.7d5e688f.js";import{_ as be}from"./TaxTypeModal.aafe8a47.js";import"./DragIcon.ba99aa6f.js";import"./SelectNotePopup.f7cb5965.js";import"./NoteModal.c43e4e1c.js";const ye={class:"grid grid-cols-12 gap-8 mt-6 mb-8"},$e={props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(t){const e=T();return(i,c)=>{const r=s("BaseCustomerSelectPopup"),y=s("BaseDatePicker"),p=s("BaseInputGroup"),_=s("BaseInput"),u=s("BaseInputGrid");return g(),M("div",ye,[o(r,{modelValue:n(e).newInvoice.customer,"onUpdate:modelValue":c[0]||(c[0]=d=>n(e).newInvoice.customer=d),valid:t.v.customer_id,"content-loading":t.isLoading,type:"invoice",class:"col-span-12 lg:col-span-5 pr-0"},null,8,["modelValue","valid","content-loading"]),o(u,{class:"col-span-12 lg:col-span-7"},{default:l(()=>[o(p,{label:i.$t("invoices.invoice_date"),"content-loading":t.isLoading,required:"",error:t.v.invoice_date.$error&&t.v.invoice_date.$errors[0].$message},{default:l(()=>[o(y,{modelValue:n(e).newInvoice.invoice_date,"onUpdate:modelValue":c[1]||(c[1]=d=>n(e).newInvoice.invoice_date=d),"content-loading":t.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),o(p,{label:i.$t("invoices.due_date"),"content-loading":t.isLoading,required:"",error:t.v.due_date.$error&&t.v.due_date.$errors[0].$message},{default:l(()=>[o(y,{modelValue:n(e).newInvoice.due_date,"onUpdate:modelValue":c[2]||(c[2]=d=>n(e).newInvoice.due_date=d),"content-loading":t.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),o(p,{label:i.$t("invoices.invoice_number"),"content-loading":t.isLoading,error:t.v.invoice_number.$error&&t.v.invoice_number.$errors[0].$message,required:""},{default:l(()=>[o(_,{modelValue:n(e).newInvoice.invoice_number,"onUpdate:modelValue":c[3]||(c[3]=d=>n(e).newInvoice.invoice_number=d),"content-loading":t.isLoading,onInput:c[4]||(c[4]=d=>t.v.invoice_number.$touch())},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),o(Ie,{store:n(e),"store-prop":"newInvoice",v:t.v,"is-loading":t.isLoading,"is-edit":t.isEdit,"customer-currency":n(e).newInvoice.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])]),_:1})])}}},Be=["onSubmit"],he={class:"flex"},Se={class:"block mt-10 invoice-foot lg:flex lg:justify-between lg:items-start"},Ce={class:"relative w-full lg:w-1/2 lg:mr-4"},Ve={class:"flex"},De={setup(t){const e=T(),i=de(),c=ue(),{t:r}=Y();let y=Z(),p=ee();const _="newInvoice";let u=P(!1);const d=P(["customer","company","customerCustom","invoice","invoiceCustom"]);let $=h(()=>e.isFetchingInvoice||e.isFetchingInitialSettings),N=h(()=>f.value?r("invoices.edit_invoice"):r("invoices.new_invoice")),f=h(()=>y.name==="invoices.edit");const D={invoice_date:{required:m.withMessage(r("validation.required"),w)},due_date:{required:m.withMessage(r("validation.required"),w)},reference_number:{maxLength:m.withMessage(r("validation.price_maxlength"),ne(255))},customer_id:{required:m.withMessage(r("validation.required"),w)},invoice_number:{required:m.withMessage(r("validation.required"),w)},exchange_rate:{required:te(function(){return m.withMessage(r("validation.required"),w),e.showExchangeRate}),decimal:m.withMessage(r("validation.valid_exchange_rate"),oe)}},B=ie(D,h(()=>e.newInvoice),{$scope:_});c.resetCustomFields(),B.value.$reset,e.resetCurrentInvoice(),e.fetchInvoiceInitialSettings(f.value),ae(()=>e.newInvoice.customer,a=>{a&&a.currency?e.newInvoice.selectedCurrency=a.currency:e.newInvoice.selectedCurrency=i.selectedCompanyCurrency});async function E(){if(B.value.$touch(),B.value.$invalid)return!1;u.value=!0;let a=j(L({},e.newInvoice),{sub_total:e.getSubTotal,total:e.getTotal,tax:e.getTotalTax});try{const v=await(f.value?e.updateInvoice:e.addInvoice)(a);p.push(`/admin/invoices/${v.data.data.id}/view`)}catch(I){console.error(I)}u.value=!1}return(a,I)=>{const v=s("BaseBreadcrumbItem"),U=s("BaseBreadcrumb"),V=s("BaseButton"),G=s("router-link"),R=s("BaseIcon"),z=s("BasePageHeader"),H=s("BaseSwitchSection"),O=s("BaseScrollPane"),A=s("BasePage");return g(),M(re,null,[o(me),o(ve),o(be),o(A,{class:"relative invoice-create-page"},{default:l(()=>[b("form",{onSubmit:ce(E,["prevent"])},[o(z,{title:n(N)},{actions:l(()=>[a.$route.name==="invoices.edit"?(g(),S(G,{key:0,to:`/invoices/pdf/${n(e).newInvoice.unique_hash}`,target:"_blank"},{default:l(()=>[o(V,{class:"mr-3",variant:"primary-outline",type:"button"},{default:l(()=>[b("span",he,F(a.$t("general.view_pdf")),1)]),_:1})]),_:1},8,["to"])):x("",!0),o(V,{loading:n(u),disabled:n(u),variant:"primary",type:"submit"},{left:l(C=>[n(u)?x("",!0):(g(),S(R,{key:0,name:"SaveIcon",class:se(C.class)},null,8,["class"]))]),default:l(()=>[le(" "+F(a.$t("invoices.save_invoice")),1)]),_:1},8,["loading","disabled"])]),default:l(()=>[o(U,null,{default:l(()=>[o(v,{title:a.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),o(v,{title:a.$tc("invoices.invoice",2),to:"/admin/invoices"},null,8,["title"]),a.$route.name==="invoices.edit"?(g(),S(v,{key:0,title:a.$t("invoices.edit_invoice"),to:"#",active:""},null,8,["title"])):(g(),S(v,{key:1,title:a.$t("invoices.new_invoice"),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),o($e,{v:n(B),"is-loading":n($),"is-edit":n(f)},null,8,["v","is-loading","is-edit"]),o(O,null,{default:l(()=>[o(ge,{currency:n(e).newInvoice.selectedCurrency,"is-loading":n($),"item-validation-scope":_,store:n(e),"store-prop":"newInvoice"},null,8,["currency","is-loading","store"]),b("div",Se,[b("div",Ce,[o(pe,{store:n(e),"store-prop":"newInvoice",fields:d.value,type:"Invoice"},null,8,["store","fields"]),o(we,{type:"Invoice","is-edit":n(f),"is-loading":n($),store:n(e),"store-prop":"newInvoice","custom-field-scope":_,class:"mb-6"},null,8,["is-edit","is-loading","store"]),o(_e,{store:n(e),"store-prop":"newInvoice","component-name":"InvoiceTemplate"},null,8,["store"]),b("div",Ve,[o(H,{modelValue:n(e).newInvoice.display_due_amount,"onUpdate:modelValue":I[0]||(I[0]=C=>n(e).newInvoice.display_due_amount=C),title:"Display due amount in invoice?"},null,8,["modelValue"])])]),o(fe,{currency:n(e).newInvoice.selectedCurrency,"is-loading":n($),store:n(e),"store-prop":"newInvoice","tax-popup-type":"invoice"},null,8,["currency","is-loading","store"])])]),_:1})],40,Be)]),_:1})],64)}}};export{De as default};
